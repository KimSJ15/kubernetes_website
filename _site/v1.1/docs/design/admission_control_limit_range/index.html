<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Admission control plugin: LimitRanger</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/guides">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Admission control plugin: LimitRanger</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h1 id="admission-control-plugin-limitranger">Admission control plugin: LimitRanger</h1>

<h2 id="background">Background</h2>

<p>This document proposes a system for enforcing resource requirements constraints as part of admission control.</p>

<h2 id="use-cases">Use cases</h2>

<ol>
  <li>Ability to enumerate resource requirement constraints per namespace</li>
  <li>Ability to enumerate min/max resource constraints for a pod</li>
  <li>Ability to enumerate min/max resource constraints for a container</li>
  <li>Ability to specify default resource limits for a container</li>
  <li>Ability to specify default resource requests for a container</li>
  <li>Ability to enforce a ratio between request and limit for a resource.</li>
</ol>

<h2 id="data-model">Data Model</h2>

<p>The <strong>LimitRange</strong> resource is scoped to a <strong>Namespace</strong>.</p>

<h3 id="type">Type</h3>

<div class="highlight">
  <pre><code class="language-go">// LimitType is a type of object that is limited
type LimitType string

const (
  // Limit that applies to all pods in a namespace
  LimitTypePod LimitType = "Pod"
  // Limit that applies to all containers in a namespace
  LimitTypeContainer LimitType = "Container"
)

// LimitRangeItem defines a min/max usage limit for any resource that matches on kind.
type LimitRangeItem struct {
  // Type of resource that this limit applies to.
  Type LimitType `json:"type,omitempty"`
  // Max usage constraints on this kind by resource name.
  Max ResourceList `json:"max,omitempty"`
  // Min usage constraints on this kind by resource name.
  Min ResourceList `json:"min,omitempty"`
  // Default resource requirement limit value by resource name if resource limit is omitted.
  Default ResourceList `json:"default,omitempty"`
  // DefaultRequest is the default resource requirement request value by resource name if resource request is omitted.
  DefaultRequest ResourceList `json:"defaultRequest,omitempty"`
  // MaxLimitRequestRatio if specified, the named resource must have a request and limit that are both non-zero where limit divided by request is less than or equal to the enumerated value; this represents the max burst for the named resource.
  MaxLimitRequestRatio ResourceList `json:"maxLimitRequestRatio,omitempty"`
}

// LimitRangeSpec defines a min/max usage limit for resources that match on kind.
type LimitRangeSpec struct {
  // Limits is the list of LimitRangeItem objects that are enforced.
  Limits []LimitRangeItem `json:"limits"`
}

// LimitRange sets resource usage limits for each kind of resource in a Namespace.
type LimitRange struct {
  TypeMeta `json:",inline"`
  // Standard object's metadata.
  // More info: http://releases.k8s.io/release-1.1/docs/devel/api-conventions.md#metadata
  ObjectMeta `json:"metadata,omitempty"`

  // Spec defines the limits enforced.
  // More info: http://releases.k8s.io/release-1.1/docs/devel/api-conventions.md#spec-and-status
  Spec LimitRangeSpec `json:"spec,omitempty"`
}

// LimitRangeList is a list of LimitRange items.
type LimitRangeList struct {
  TypeMeta `json:",inline"`
  // Standard list metadata.
  // More info: http://releases.k8s.io/release-1.1/docs/devel/api-conventions.md#types-kinds
  ListMeta `json:"metadata,omitempty"`

  // Items is a list of LimitRange objects.
  // More info: http://releases.k8s.io/release-1.1/docs/design/admission_control_limit_range.md
  Items []LimitRange `json:"items"`
}
</code></pre>
</div>

<h3 id="validation">Validation</h3>

<p>Validation of a <strong>LimitRange</strong> enforces that for a given named resource the following rules apply:</p>

<p>Min (if specified) &lt;= DefaultRequest (if specified) &lt;= Default (if specified) &lt;= Max (if specified)</p>

<h3 id="default-value-behavior">Default Value Behavior</h3>

<p>The following default value behaviors are applied to a LimitRange for a given named resource.</p>

<pre><code>
if LimitRangeItem.Default[resourceName] is undefined 
  if LimitRangeItem.Max[resourceName] is defined
    LimitRangeItem.Default[resourceName] = LimitRangeItem.Max[resourceName]

</code></pre>

<pre><code>
if LimitRangeItem.DefaultRequest[resourceName] is undefined
  if LimitRangeItem.Default[resourceName] is defined
    LimitRangeItem.DefaultRequest[resourceName] = LimitRangeItem.Default[resourceName]
  else if LimitRangeItem.Min[resourceName] is defined
    LimitRangeItem.DefaultRequest[resourceName] = LimitRangeItem.Min[resourceName]

</code></pre>

<h2 id="admissioncontrol-plugin-limitranger">AdmissionControl plugin: LimitRanger</h2>

<p>The <strong>LimitRanger</strong> plug-in introspects all incoming pod requests and evaluates the constraints defined on a LimitRange.</p>

<p>If a constraint is not specified for an enumerated resource, it is not enforced or tracked.</p>

<p>To enable the plug-in and support for LimitRange, the kube-apiserver must be configured as follows:</p>

<div class="highlight">
  <pre><code class="language-console">$ kube-apiserver --admission-control=LimitRanger
</code></pre>
</div>

<h3 id="enforcement-of-constraints">Enforcement of constraints</h3>

<p><strong>Type: Container</strong></p>

<p>Supported Resources:</p>

<ol>
  <li>memory</li>
  <li>cpu</li>
</ol>

<p>Supported Constraints:</p>

<p>Per container, the following must hold true</p>

<table>
  <thead>
    <tr>
      <th>Constraint</th>
      <th>Behavior</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Min</td>
      <td>Min &lt;= Request (required) &lt;= Limit (optional)</td>
    </tr>
    <tr>
      <td>Max</td>
      <td>Limit (required) &lt;= Max</td>
    </tr>
    <tr>
      <td>LimitRequestRatio</td>
      <td>LimitRequestRatio &lt;= ( Limit (required, non-zero) / Request (required, non-zero))</td>
    </tr>
  </tbody>
</table>

<p>Supported Defaults:</p>

<ol>
  <li>Default - if the named resource has no enumerated value, the Limit is equal to the Default</li>
  <li>DefaultRequest - if the named resource has no enumerated value, the Request is equal to the DefaultRequest</li>
</ol>

<p><strong>Type: Pod</strong></p>

<p>Supported Resources:</p>

<ol>
  <li>memory</li>
  <li>cpu</li>
</ol>

<p>Supported Constraints:</p>

<p>Across all containers in pod, the following must hold true</p>

<table>
  <thead>
    <tr>
      <th>Constraint</th>
      <th>Behavior</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Min</td>
      <td>Min &lt;= Request (required) &lt;= Limit (optional)</td>
    </tr>
    <tr>
      <td>Max</td>
      <td>Limit (required) &lt;= Max</td>
    </tr>
    <tr>
      <td>LimitRequestRatio</td>
      <td>LimitRequestRatio &lt;= ( Limit (required, non-zero) / Request (non-zero) )</td>
    </tr>
  </tbody>
</table>

<h2 id="run-time-configuration">Run-time configuration</h2>

<p>The default <code>LimitRange</code> that is applied via Salt configuration will be updated as follows:</p>

<pre><code>
apiVersion: "v1"
kind: "LimitRange"
metadata:
  name: "limits"
  namespace: default
spec:
  limits:
    - type: "Container"
      defaultRequests:
        cpu: "100m"

</code></pre>

<h2 id="example">Example</h2>

<p>An example LimitRange configuration:</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Resource</th>
      <th>Min</th>
      <th>Max</th>
      <th>Default</th>
      <th>DefaultRequest</th>
      <th>LimitRequestRatio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Container</td>
      <td>cpu</td>
      <td>.1</td>
      <td>1</td>
      <td>500m</td>
      <td>250m</td>
      <td>4</td>
    </tr>
    <tr>
      <td>Container</td>
      <td>memory</td>
      <td>250Mi</td>
      <td>1Gi</td>
      <td>500Mi</td>
      <td>250Mi</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>Assuming an incoming container that specified no incoming resource requirements,
the following would happen.</p>

<ol>
  <li>The incoming container cpu would request 250m with a limit of 500m.</li>
  <li>The incoming container memory would request 250Mi with a limit of 500Mi</li>
  <li>If the container is later resized, it’s cpu would be constrained to between .1 and 1 and the ratio of limit to request could not exceed 4.</li>
</ol>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/design/admission_control_limit_range.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



