<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - CoreOS Multinode Cluster</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>CoreOS Multinode Cluster</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h1 id="coreos-multinode-cluster">CoreOS Multinode Cluster</h1>

<p>Use the <a href="cloud-configs/master.yaml">master.yaml</a> and <a href="cloud-configs/node.yaml">node.yaml</a> cloud-configs to provision a multi-node Kubernetes cluster.</p>

<blockquote>
  <p><strong>Attention</strong>: This requires at least CoreOS version <strong><a href="https://coreos.com/releases/#695.0.0">695.0.0</a></strong>, which includes <code>etcd2</code>.</p>
</blockquote>

<h2 id="overview">Overview</h2>

<ul>
  <li>Provision the master node</li>
  <li>Capture the master node private IP address</li>
  <li>Edit node.yaml</li>
  <li>Provision one or more worker nodes</li>
</ul>

<h3 id="aws">AWS</h3>

<p><em>Attention:</em> Replace <code>&lt;ami_image_id&gt;</code> below for a <a href="https://coreos.com/docs/running-coreos/cloud-providers/ec2/">suitable version of CoreOS image for AWS</a>.</p>

<h4 id="provision-the-master">Provision the Master</h4>

<div class="highlight">
  <pre><code class="language-sh">aws ec2 create-security-group --group-name kubernetes --description "Kubernetes Security Group"
aws ec2 authorize-security-group-ingress --group-name kubernetes --protocol tcp --port 22 --cidr 0.0.0.0/0
aws ec2 authorize-security-group-ingress --group-name kubernetes --protocol tcp --port 80 --cidr 0.0.0.0/0
aws ec2 authorize-security-group-ingress --group-name kubernetes --source-security-group-name kubernetes
</code></pre>
</div>

<div class="highlight">
  <pre><code class="language-sh">aws ec2 run-instances \
--image-id &lt;ami_image_id&gt; \
--key-name &lt;keypair&gt; \
--region us-west-2 \
--security-groups kubernetes \
--instance-type m3.medium \
--user-data file://master.yaml
</code></pre>
</div>

<h4 id="capture-the-private-ip-address">Capture the private IP address</h4>

<div class="highlight">
  <pre><code class="language-sh">aws ec2 describe-instances --instance-id &lt;master-instance-id&gt;
</code></pre>
</div>

<h4 id="edit-nodeyaml">Edit node.yaml</h4>

<p>Edit <code>node.yaml</code> and replace all instances of <code>&lt;master-private-ip&gt;</code> with the private IP address of the master node.</p>

<h4 id="provision-worker-nodes">Provision worker nodes</h4>

<div class="highlight">
  <pre><code class="language-sh">aws ec2 run-instances \
--count 1 \
--image-id &lt;ami_image_id&gt; \
--key-name &lt;keypair&gt; \
--region us-west-2 \
--security-groups kubernetes \
--instance-type m3.medium \
--user-data file://node.yaml
</code></pre>
</div>

<h3 id="google-compute-engine-gce">Google Compute Engine (GCE)</h3>

<p><em>Attention:</em> Replace <code>&lt;gce_image_id&gt;</code> below for a <a href="https://coreos.com/docs/running-coreos/cloud-providers/google-compute-engine/">suitable version of CoreOS image for Google Compute Engine</a>.</p>

<h4 id="provision-the-master-1">Provision the Master</h4>

<div class="highlight">
  <pre><code class="language-sh">gcloud compute instances create master \
--image-project coreos-cloud \
--image &lt;gce_image_id&gt; \
--boot-disk-size 200GB \
--machine-type n1-standard-1 \
--zone us-central1-a \
--metadata-from-file user-data=master.yaml
</code></pre>
</div>

<h4 id="capture-the-private-ip-address-1">Capture the private IP address</h4>

<div class="highlight">
  <pre><code class="language-sh">gcloud compute instances list
</code></pre>
</div>

<h4 id="edit-nodeyaml-1">Edit node.yaml</h4>

<p>Edit <code>node.yaml</code> and replace all instances of <code>&lt;master-private-ip&gt;</code> with the private IP address of the master node.</p>

<h4 id="provision-worker-nodes-1">Provision worker nodes</h4>

<div class="highlight">
  <pre><code class="language-sh">gcloud compute instances create node1 \
--image-project coreos-cloud \
--image &lt;gce_image_id&gt; \
--boot-disk-size 200GB \
--machine-type n1-standard-1 \
--zone us-central1-a \
--metadata-from-file user-data=node.yaml
</code></pre>
</div>

<h4 id="establish-network-connectivity">Establish network connectivity</h4>

<p>Next, setup an ssh tunnel to the master so you can run kubectl from your local host.
In one terminal, run <code>gcloud compute ssh master --ssh-flag="-L 8080:127.0.0.1:8080"</code> and in a second
run <code>gcloud compute ssh master --ssh-flag="-R 8080:127.0.0.1:8080"</code>.</p>

<h3 id="openstack">OpenStack</h3>

<p>These instructions are for running on the command line.  Most of this you can also do through the Horizon dashboard.
These instructions were tested on the Ice House release on a Metacloud distribution of OpenStack but should be similar if not the same across other versions/distributions of OpenStack.</p>

<h4 id="make-sure-you-can-connect-with-openstack">Make sure you can connect with OpenStack</h4>

<p>Make sure the environment variables are set for OpenStack such as:</p>

<div class="highlight">
  <pre><code class="language-sh">OS_TENANT_ID
OS_PASSWORD
OS_AUTH_URL
OS_USERNAME
OS_TENANT_NAME
</code></pre>
</div>

<p>Test this works with something like:</p>

<pre><code>
nova list

</code></pre>

<h4 id="get-a-suitable-coreos-image">Get a Suitable CoreOS Image</h4>

<p>You’ll need a <a href="https://coreos.com/os/docs/latest/booting-on-openstack.html">suitable version of CoreOS image for OpenStack</a>
Once you download that, upload it to glance.  An example is shown below:</p>

<div class="highlight">
  <pre><code class="language-sh">glance image-create --name CoreOS723 \
--container-format bare --disk-format qcow2 \
--file coreos_production_openstack_image.img \
--is-public True
</code></pre>
</div>

<h4 id="create-security-group">Create security group</h4>

<div class="highlight">
  <pre><code class="language-sh">nova secgroup-create kubernetes "Kubernetes Security Group"
nova secgroup-add-rule kubernetes tcp 22 22   0.0.0.0/0
nova secgroup-add-rule kubernetes tcp 80 80   0.0.0.0/0
</code></pre>
</div>

<h4 id="provision-the-master-2">Provision the Master</h4>

<div class="highlight">
  <pre><code class="language-sh">nova boot \
--image &lt;image_name&gt; \
--key-name &lt;my_key&gt; \
--flavor &lt;flavor id&gt; \
--security-group kubernetes \
--user-data files/master.yaml \
kube-master
</code></pre>
</div>

<p><code>&lt;image_name&gt;</code> is the CoreOS image name.  In our example we can use the image we created in the previous step and put in ‘CoreOS723’</p>

<p><code>&lt;my_key&gt;</code> is the keypair name that you already generated to access the instance.</p>

<p><code>&lt;flavor_id&gt;</code> is the flavor ID you use to size the instance.  Run <code>nova flavor-list</code> to get the IDs.  3 on the system this was tested with gives the m1.large size.</p>

<p>The important part is to ensure you have the files/master.yml as this is what will do all the post boot configuration. This path is relevant so we are assuming in this example that you are running the nova command in a directory where there is a subdirectory called files that has the master.yml file in it.  Absolute paths also work.</p>

<p>Next, assign it a public IP address:</p>

<pre><code>
nova floating-ip-list

</code></pre>

<p>Get an IP address that’s free and run:</p>

<pre><code>
nova floating-ip-associate kube-master &lt;ip address&gt;

</code></pre>

<p>where <code>&lt;ip address&gt;</code> is the IP address that was available from the <code>nova floating-ip-list</code> command.</p>

<h4 id="provision-worker-nodes-2">Provision Worker Nodes</h4>

<p>Edit <code>node.yaml</code> and replace all instances of <code>&lt;master-private-ip&gt;</code> with the private IP address of the master node.  You can get this by running <code>nova show kube-master</code> assuming you named your instance kube master.  This is not the floating IP address you just assigned it.</p>

<div class="highlight">
  <pre><code class="language-sh">nova boot \
--image &lt;image_name&gt; \
--key-name &lt;my_key&gt; \
--flavor &lt;flavor id&gt; \
--security-group kubernetes \
--user-data files/node.yaml \
minion01
</code></pre>
</div>

<p>This is basically the same as the master nodes but with the node.yaml post-boot script instead of the master.</p>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/coreos/coreos_multinode_cluster.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



