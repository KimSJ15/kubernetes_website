<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Configuring Kubernetes on Fedora via Ansible</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1>User Guides</h1>
	<h5>How to get started, and acheive tasks, using Kubernetes</h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            
    <a class="item" data-title="Overview" href="/v1.1/" ></a>
<div class="item" data-title="Quickstarts">
  <div class="container">
    <a class="item" data-title="TODO - 5-minute Quickstart" href="/v1.1/docs/hellonode" ></a>
    <a class="item" data-title="Kubernetes 101" href="/v1.1/docs/user-guide/walkthrough/README" ></a>
    <a class="item" data-title="Kubernetes 201" href="/v1.1/docs/user-guide/walkthrough/k8s201" ></a>

  </div>
</div>
<div class="item" data-title="Running Kubernetes">
  <div class="container">
    <a class="item" data-title="Picking the Right Solution" href="/v1.1/docs/getting-started-guides/README" ></a>
<div class="item" data-title="Running Kubernetes on Your Local Machine">
  <div class="container">
    <a class="item" data-title="Running Kubernetes Locally via Docker" href="/v1.1/docs/getting-started-guides/docker" ></a>
    <a class="item" data-title="Running Kubernetes Locally via Vagrant" href="/v1.1/docs/getting-started-guides/vagrant" ></a>
    <a class="item" data-title="Running Kubernetes Locally with No VM" href="/v1.1/docs/getting-started-guides/locally" ></a>

  </div>
</div>
    <a class="item" data-title="Running Kubernetes on Google Container Engine" href="https://cloud.google.com/container-engine/docs/before-you-begin" ></a>
<div class="item" data-title="Running Kubernetes on Turn-key Cloud Solutions">
  <div class="container">
    <a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/v1.1/docs/getting-started-guides/gce" ></a>
    <a class="item" data-title="Running Kubernetes on AWS EC2" href="/v1.1/docs/getting-started-guides/aws" ></a>
    <a class="item" data-title="Running Kubernetes on Azure" href="/v1.1/docs/getting-started-guides/coreos/azure/README" ></a>

  </div>
</div>
<div class="item" data-title="Running Kubernetes on Custom Solutions">
  <div class="container">
    <a class="item" data-title="Getting Started From Scratch" href="/v1.1/docs/getting-started-guides/scratch" ></a>
<div class="item" data-title="Custom Cloud Solutions">
  <div class="container">
    <a class="item" data-title="AWS or GCE on CoreOS" href="/v1.1/docs/getting-started-guides/coreos" ></a>
    <a class="item" data-title="AWS or Joyent on Ubuntu" href="/v1.1/docs/getting-started-guides/juju" ></a>
    <a class="item" data-title="Rackspace on CoreOS" href="/v1.1/docs/getting-started-guides/rackspace" ></a>

  </div>
</div>
<div class="item" data-title="On-Premise VMs">
  <div class="container">
    <a class="item" data-title="Vagrant or VMware" href="/v1.1/docs/getting-started-guides/coreos" ></a>
    <a class="item" data-title="Cloudstack" href="/v1.1/docs/getting-started-guides/cloudstack" ></a>
    <a class="item" data-title="VMWare" href="/v1.1/docs/getting-started-guides/vsphere" ></a>
    <a class="item" data-title="Juju" href="/v1.1/docs/getting-started-guides/juju" ></a>
    <a class="item" data-title="libvirt on CoreOS" href="/v1.1/docs/getting-started-guides/libvirt-coreos" ></a>
    <a class="item" data-title="oVirt" href="/v1.1/docs/getting-started-guides/ovirt" ></a>
    <a class="item" data-title="libvirt or KVM" href="/v1.1/docs/getting-started-guides/fedora/flannel_multi_node_cluster" ></a>

  </div>
</div>
<div class="item" data-title="Bare Metal">
  <div class="container">
    <a class="item" data-title="Offline" href="/v1.1/docs/getting-started-guides/coreos/bare_metal_offline" ></a>
    <a class="item" data-title="Fedora via Ansible" href="/v1.1/docs/getting-started-guides/fedora/fedora_ansible_config" ></a>
    <a class="item" data-title="Fedora (Single Node)" href="/v1.1/docs/getting-started-guides/fedora/fedora_manual_config" ></a>
    <a class="item" data-title="Fedora (Multi Node)" href="/v1.1/docs/getting-started-guides/fedora/flannel_multi_node_cluster" ></a>
    <a class="item" data-title="Centos" href="/v1.1/docs/getting-started-guides/centos/centos_manual_config" ></a>
    <a class="item" data-title="Ubuntu" href="/v1.1/docs/getting-started-guides/ubuntu" ></a>
    <a class="item" data-title="Docker (Multi Node)" href="/v1.1/docs/getting-started-guides/docker-multinode" ></a>

  </div>
</div>

  </div>
</div>

  </div>
</div>
<div class="item" data-title="Common Tasks">
  <div class="container">
    <a class="item" data-title="Using Clusters" href="/v1.1/docs/admin/introduction" ></a>
    <a class="item" data-title="Using Multiple Clusters" href="/v1.1/docs/admin/multi-cluster" ></a>
    <a class="item" data-title="Using Large Clusters" href="/v1.1/docs/admin/cluster-large" ></a>
    <a class="item" data-title="Building High-Availability Clusters" href="/v1.1/docs/admin/high-availability" ></a>
    <a class="item" data-title="Accessing Clusters" href="/v1.1/docs/user-guide/accessing-the-cluster" ></a>
    <a class="item" data-title="Sharing a Cluster" href="/v1.1/docs/admin/namespaces/README" ></a>
    <a class="item" data-title="Changing Cluster Size" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ#how-do-i-change-the-size-of-my-cluster" ></a>
    <a class="item" data-title="Creating a Custom Cluster from Scratch" href="/v1.1/docs/getting-started-guides/scratch" ></a>
    <a class="item" data-title="Authenticating Across Clusters with kubeconfig" href="/v1.1/docs/user-guide/kubeconfig-file" ></a>
    <a class="item" data-title="Using Nodes" href="/v1.1/docs/admin/node" ></a>
    <a class="item" data-title="Assigning Pods to Nodes" href="/v1.1/docs/user-guide/node-selection/README" ></a>
    <a class="item" data-title="Using Configuration Files" href="/v1.1/docs/user-guide/simple-yaml" ></a>
    <a class="item" data-title="Configuring Containers" href="/v1.1/docs/user-guide/configuring-containers" ></a>
    <a class="item" data-title="Configuring Kubernetes with Salt" href="/v1.1/docs/admin/salt" ></a>
    <a class="item" data-title="Using Environment Variables" href="/v1.1/docs/user-guide/environment-guide/README" ></a>
    <a class="item" data-title="Configuring Garbage Collection" href="/v1.1/docs/admin/garbage-collection" ></a>
    <a class="item" data-title="Managing Compute Resources" href="/v1.1/docs/user-guide/compute-resources" ></a>
    <a class="item" data-title="Applying Resource Quotas and Limits" href="/v1.1/docs/admin/resourcequota/README" ></a>
    <a class="item" data-title="Setting Pod CPU and Memory Limits" href="/v1.1/docs/admin/limitrange/README" ></a>
    <a class="item" data-title="Managing Deployments" href="/v1.1/docs/user-guide/managing-deployments" ></a>
    <a class="item" data-title="Deploying Applications" href="/v1.1/docs/user-guide/deploying-applications" ></a>
    <a class="item" data-title="Launching, Exposing, and Killing Applications" href="/v1.1/docs/user-guide/quick-start" ></a>
    <a class="item" data-title="Connecting Applications" href="/v1.1/docs/user-guide/connecting-applications" ></a>
    <a class="item" data-title="Networking in Kubernetes" href="/v1.1/docs/admin/networking" ></a>
    <a class="item" data-title="Creating Servers with External IPs" href="/v1.1/examples/simple-nginx" ></a>
    <a class="item" data-title="Setting Up and Configuring DNS" href="/v1.1/examples/cluster-dns/README" ></a>
    <a class="item" data-title="Using DNS Pods and Services" href="/v1.1/docs/admin/dns" ></a>
    <a class="item" data-title="Working with Containers" href="/v1.1/docs/user-guide/production-pods" ></a>
    <a class="item" data-title="Creating Pods with the Downward API" href="/v1.1/docs/user-guide/downward-api/README" ></a>
    <a class="item" data-title="Using Secrets" href="/v1.1/docs/user-guide/secrets/README" ></a>
    <a class="item" data-title="Using Persistent Volumes" href="/v1.1/docs/user-guide/persistent-volumes/README" ></a>
    <a class="item" data-title="Updating Live Pods" href="/v1.1/docs/user-guide/update-demo/README" ></a>

  </div>
</div>
<div class="item" data-title="Testing and Monitoring">
  <div class="container">
    <a class="item" data-title="Simulating Large Test Loads" href="/v1.1/examples/k8petstore/README" ></a>
    <a class="item" data-title="Checking Pod Health" href="/v1.1/docs/user-guide/liveness/README" ></a>
    <a class="item" data-title="Using Explorer to Examine the Runtime Environment" href="/v1.1/examples/explorer/README" ></a>
    <a class="item" data-title="Resource Usage Monitoring" href="/v1.1/docs/user-guide/monitoring" ></a>

  </div>
</div>

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Configuring Kubernetes on Fedora via Ansible</h1>
		<p>Configuring Kubernetes on Fedora via Ansible offers a simple way to quickly create a clustered environment with little effort.</p>

<h2 id="table-of-contents">Table of Contents</h2>

<div id="pageTOC" style="padding-top:15px; font-weight: bold; width: auto;"></div>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
  <li>Host able to run ansible and able to clone the following repo: <a href="https://github.com/kubernetes/kubernetes.git">kubernetes</a></li>
  <li>A Fedora 21+ host to act as cluster master</li>
  <li>As many Fedora 21+ hosts as you would like, that act as cluster nodes</li>
</ol>

<p>The hosts can be virtual or bare metal. Ansible will take care of the rest of the configuration for you - configuring networking, installing packages, handling the firewall, etc. This example will use one master and two nodes.</p>

<h2 id="architecture-of-the-cluster">Architecture of the cluster</h2>

<p>A Kubernetes cluster requires etcd, a master, and n nodes, so we will create a cluster with three hosts, for example:</p>

<div class="highlight">
  <pre><code class="language-console">master,etcd = kube-master.example.com
    node1 = kube-node-01.example.com
    node2 = kube-node-02.example.com
</code></pre>
</div>

<p><strong>Make sure your local machine has</strong></p>

<ul>
  <li>ansible (must be 1.9.0+)</li>
  <li>git</li>
  <li>python-netaddr</li>
</ul>

<p>If not</p>

<div class="highlight">
  <pre><code class="language-sh">yum install -y ansible git python-netaddr
</code></pre>
</div>

<p><strong>Now clone down the Kubernetes repository</strong></p>

<div class="highlight">
  <pre><code class="language-sh">git clone https://github.com/kubernetes/contrib.git
cd contrib/ansible
</code></pre>
</div>

<p><strong>Tell ansible about each machine and its role in your cluster</strong></p>

<p>Get the IP addresses from the master and nodes.  Add those to the <code>~/contrib/ansible/inventory</code> file on the host running Ansible.</p>

<div class="highlight">
  <pre><code class="language-console">[masters]
kube-master.example.com

[etcd]
kube-master.example.com

[nodes]
kube-node-01.example.com
kube-node-02.example.com
</code></pre>
</div>

<h2 id="setting-up-ansible-access-to-your-nodes">Setting up ansible access to your nodes</h2>

<p>If you already are running on a machine which has passwordless ssh access to the kube-master and kube-node-{01,02} nodes, and ‘sudo’ privileges, simply set the value of <code>ansible_ssh_user</code> in <code>~/contrib/ansible/group_vars/all.yaml</code> to the username which you use to ssh to the nodes (i.e. <code>fedora</code>), and proceed to the next step…</p>

<p><em>Otherwise</em> setup ssh on the machines like so (you will need to know the root password to all machines in the cluster).</p>

<p>edit: ~/contrib/ansible/group_vars/all.yml</p>

<div class="highlight">
  <pre><code class="language-yaml">ansible_ssh_user: root
</code></pre>
</div>

<p><strong>Configuring ssh access to the cluster</strong></p>

<p>If you already have ssh access to every machine using ssh public keys you may skip to <a href="#setting-up-the-cluster">setting up the cluster</a></p>

<p>Make sure your local machine (root) has an ssh key pair if not</p>

<div class="highlight">
  <pre><code class="language-sh">ssh-keygen
</code></pre>
</div>

<p>Copy the ssh public key to <strong>all</strong> nodes in the cluster</p>

<div class="highlight">
  <pre><code class="language-sh">for node in kube-master.example.com kube-node-01.example.com kube-node-02.example.com; do
  ssh-copy-id ${node}
done
</code></pre>
</div>

<h2 id="setting-up-the-cluster">Setting up the cluster</h2>

<p>Although the default value of variables in <code>~/contrib/ansible/group_vars/all.yml</code> should be good enough, if not, change them as needed.</p>

<p>edit: ~/contrib/ansible/group_vars/all.yml</p>

<p><strong>Configure access to kubernetes packages</strong></p>

<p>Modify <code>source_type</code> as below to access kubernetes packages through the package manager.</p>

<div class="highlight">
  <pre><code class="language-yaml">source_type: packageManager
</code></pre>
</div>

<p><strong>Configure the IP addresses used for services</strong></p>

<p>Each Kubernetes service gets its own IP address.  These are not real IPs.  You need only select a range of IPs which are not in use elsewhere in your environment.</p>

<div class="highlight">
  <pre><code class="language-yaml">kube_service_addresses: 10.254.0.0/16
</code></pre>
</div>

<p><strong>Managing flannel</strong></p>

<p>Modify <code>flannel_subnet</code>, <code>flannel_prefix</code> and <code>flannel_host_prefix</code> only if defaults are not appropriate for your cluster.</p>

<p><strong>Managing add on services in your cluster</strong></p>

<p>Set <code>cluster_logging</code> to false or true (default) to disable or enable logging with elasticsearch.</p>

<div class="highlight">
  <pre><code class="language-yaml">cluster_logging: true
</code></pre>
</div>

<p>Turn <code>cluster_monitoring</code> to true (default) or false to enable or disable cluster monitoring with heapster and influxdb.</p>

<div class="highlight">
  <pre><code class="language-yaml">cluster_monitoring: true
</code></pre>
</div>

<p>Turn <code>dns_setup</code> to true (recommended) or false to enable or disable whole DNS configuration.</p>

<div class="highlight">
  <pre><code class="language-yaml">dns_setup: true
</code></pre>
</div>

<p><strong>Tell ansible to get to work!</strong></p>

<p>This will finally setup your whole Kubernetes cluster for you.</p>

<div class="highlight">
  <pre><code class="language-sh">cd ~/contrib/ansible/

./setup.sh
</code></pre>
</div>

<h2 id="testing-and-using-your-new-cluster">Testing and using your new cluster</h2>

<p>That’s all there is to it.  It’s really that easy.  At this point you should have a functioning Kubernetes cluster.</p>

<p><strong>Show kubernetes nodes</strong></p>

<p>Run the following on the kube-master:</p>

<div class="highlight">
  <pre><code class="language-sh">kubectl get nodes
</code></pre>
</div>

<p><strong>Show services running on masters and nodes</strong></p>

<div class="highlight">
  <pre><code class="language-sh">systemctl | grep -i kube
</code></pre>
</div>

<p><strong>Show firewall rules on the masters and nodes</strong></p>

<div class="highlight">
  <pre><code class="language-sh">iptables -nvL
</code></pre>
</div>

<p><strong>Create /tmp/apache.json on the master with the following contents and deploy pod</strong></p>

<div class="highlight">
  <pre><code class="language-json">{
  "kind": "Pod",
  "apiVersion": "v1",
  "metadata": {
    "name": "fedoraapache",
    "labels": {
      "name": "fedoraapache"
    }
  },
  "spec": {
    "containers": [
      {
        "name": "fedoraapache",
        "image": "fedora/apache",
        "ports": [
          {
            "hostPort": 80,
            "containerPort": 80
          }
        ]
      }
    ]
  }
}
</code></pre>
</div>

<div class="highlight">
  <pre><code class="language-sh">kubectl create -f /tmp/apache.json
</code></pre>
</div>

<p><strong>Check where the pod was created</strong></p>

<div class="highlight">
  <pre><code class="language-sh">kubectl get pods
</code></pre>
</div>

<p><strong>Check Docker status on nodes</strong></p>

<div class="highlight">
  <pre><code class="language-sh">docker ps
docker images
</code></pre>
</div>

<p><strong>After the pod is ‘Running’ Check web server access on the node</strong></p>

<div class="highlight">
  <pre><code class="language-sh">curl http://localhost
</code></pre>
</div>

<p>That’s it !</p>

	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



