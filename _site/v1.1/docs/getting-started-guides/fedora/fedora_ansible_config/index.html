<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Configuring Kubernetes on Fedora via Ansible</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/guides">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Configuring Kubernetes on Fedora via Ansible</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->
<p>Configuring Kubernetes on <a href="http://fedoraproject.org">Fedora</a> via <a href="http://www.ansible.com/home">Ansible</a>
——————————————————————————————————-</p>

<p>Configuring Kubernetes on Fedora via Ansible offers a simple way to quickly create a clustered environment with little effort.</p>

<p><strong>Table of Contents</strong></p>

<ul>
  <li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#architecture-of-the-cluster">Architecture of the cluster</a></li>
  <li><a href="#setting-up-ansible-access-to-your-nodes">Setting up ansible access to your nodes</a></li>
  <li><a href="#setting-up-the-cluster">Setting up the cluster</a></li>
  <li><a href="#testing-and-using-your-new-cluster">Testing and using your new cluster</a></li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
  <li>Host able to run ansible and able to clone the following repo: <a href="https://github.com/kubernetes/kubernetes.git">kubernetes</a></li>
  <li>A Fedora 21+ host to act as cluster master</li>
  <li>As many Fedora 21+ hosts as you would like, that act as cluster nodes</li>
</ol>

<p>The hosts can be virtual or bare metal. Ansible will take care of the rest of the configuration for you - configuring networking, installing packages, handling the firewall, etc. This example will use one master and two nodes.</p>

<h2 id="architecture-of-the-cluster">Architecture of the cluster</h2>

<p>A Kubernetes cluster requires etcd, a master, and n nodes, so we will create a cluster with three hosts, for example:</p>

<div class="highlight">
  <pre><code class="language-console">master,etcd = kube-master.example.com
    node1 = kube-node-01.example.com
    node2 = kube-node-02.example.com
</code></pre>
</div>

<p><strong>Make sure your local machine has</strong></p>

<ul>
  <li>ansible (must be 1.9.0+)</li>
  <li>git</li>
  <li>python-netaddr</li>
</ul>

<p>If not</p>

<div class="highlight">
  <pre><code class="language-sh">yum install -y ansible git python-netaddr
</code></pre>
</div>

<p><strong>Now clone down the Kubernetes repository</strong></p>

<div class="highlight">
  <pre><code class="language-sh">git clone https://github.com/kubernetes/contrib.git
cd contrib/ansible
</code></pre>
</div>

<p><strong>Tell ansible about each machine and its role in your cluster</strong></p>

<p>Get the IP addresses from the master and nodes.  Add those to the <code>~/contrib/ansible/inventory</code> file on the host running Ansible.</p>

<div class="highlight">
  <pre><code class="language-console">[masters]
kube-master.example.com

[etcd]
kube-master.example.com

[nodes]
kube-node-01.example.com
kube-node-02.example.com
</code></pre>
</div>

<h2 id="setting-up-ansible-access-to-your-nodes">Setting up ansible access to your nodes</h2>

<p>If you already are running on a machine which has passwordless ssh access to the kube-master and kube-node-{01,02} nodes, and ‘sudo’ privileges, simply set the value of <code>ansible_ssh_user</code> in <code>~/contrib/ansible/group_vars/all.yaml</code> to the username which you use to ssh to the nodes (i.e. <code>fedora</code>), and proceed to the next step…</p>

<p><em>Otherwise</em> setup ssh on the machines like so (you will need to know the root password to all machines in the cluster).</p>

<p>edit: ~/contrib/ansible/group_vars/all.yml</p>

<div class="highlight">
  <pre><code class="language-yaml">ansible_ssh_user: root
</code></pre>
</div>

<p><strong>Configuring ssh access to the cluster</strong></p>

<p>If you already have ssh access to every machine using ssh public keys you may skip to <a href="#setting-up-the-cluster">setting up the cluster</a></p>

<p>Make sure your local machine (root) has an ssh key pair if not</p>

<div class="highlight">
  <pre><code class="language-sh">ssh-keygen
</code></pre>
</div>

<p>Copy the ssh public key to <strong>all</strong> nodes in the cluster</p>

<div class="highlight">
  <pre><code class="language-sh">for node in kube-master.example.com kube-node-01.example.com kube-node-02.example.com; do
  ssh-copy-id ${node}
done
</code></pre>
</div>

<h2 id="setting-up-the-cluster">Setting up the cluster</h2>

<p>Although the default value of variables in <code>~/contrib/ansible/group_vars/all.yml</code> should be good enough, if not, change them as needed.</p>

<p>edit: ~/contrib/ansible/group_vars/all.yml</p>

<p><strong>Configure access to kubernetes packages</strong></p>

<p>Modify <code>source_type</code> as below to access kubernetes packages through the package manager.</p>

<div class="highlight">
  <pre><code class="language-yaml">source_type: packageManager
</code></pre>
</div>

<p><strong>Configure the IP addresses used for services</strong></p>

<p>Each Kubernetes service gets its own IP address.  These are not real IPs.  You need only select a range of IPs which are not in use elsewhere in your environment.</p>

<div class="highlight">
  <pre><code class="language-yaml">kube_service_addresses: 10.254.0.0/16
</code></pre>
</div>

<p><strong>Managing flannel</strong></p>

<p>Modify <code>flannel_subnet</code>, <code>flannel_prefix</code> and <code>flannel_host_prefix</code> only if defaults are not appropriate for your cluster.</p>

<p><strong>Managing add on services in your cluster</strong></p>

<p>Set <code>cluster_logging</code> to false or true (default) to disable or enable logging with elasticsearch.</p>

<div class="highlight">
  <pre><code class="language-yaml">cluster_logging: true
</code></pre>
</div>

<p>Turn <code>cluster_monitoring</code> to true (default) or false to enable or disable cluster monitoring with heapster and influxdb.</p>

<div class="highlight">
  <pre><code class="language-yaml">cluster_monitoring: true
</code></pre>
</div>

<p>Turn <code>dns_setup</code> to true (recommended) or false to enable or disable whole DNS configuration.</p>

<div class="highlight">
  <pre><code class="language-yaml">dns_setup: true
</code></pre>
</div>

<p><strong>Tell ansible to get to work!</strong></p>

<p>This will finally setup your whole Kubernetes cluster for you.</p>

<div class="highlight">
  <pre><code class="language-sh">cd ~/contrib/ansible/

./setup.sh
</code></pre>
</div>

<h2 id="testing-and-using-your-new-cluster">Testing and using your new cluster</h2>

<p>That’s all there is to it.  It’s really that easy.  At this point you should have a functioning Kubernetes cluster.</p>

<p><strong>Show kubernetes nodes</strong></p>

<p>Run the following on the kube-master:</p>

<div class="highlight">
  <pre><code class="language-sh">kubectl get nodes
</code></pre>
</div>

<p><strong>Show services running on masters and nodes</strong></p>

<div class="highlight">
  <pre><code class="language-sh">systemctl | grep -i kube
</code></pre>
</div>

<p><strong>Show firewall rules on the masters and nodes</strong></p>

<div class="highlight">
  <pre><code class="language-sh">iptables -nvL
</code></pre>
</div>

<p><strong>Create /tmp/apache.json on the master with the following contents and deploy pod</strong></p>

<div class="highlight">
  <pre><code class="language-json">{
  "kind": "Pod",
  "apiVersion": "v1",
  "metadata": {
    "name": "fedoraapache",
    "labels": {
      "name": "fedoraapache"
    }
  },
  "spec": {
    "containers": [
      {
        "name": "fedoraapache",
        "image": "fedora/apache",
        "ports": [
          {
            "hostPort": 80,
            "containerPort": 80
          }
        ]
      }
    ]
  }
}
</code></pre>
</div>

<div class="highlight">
  <pre><code class="language-sh">kubectl create -f /tmp/apache.json
</code></pre>
</div>

<p><strong>Check where the pod was created</strong></p>

<div class="highlight">
  <pre><code class="language-sh">kubectl get pods
</code></pre>
</div>

<p><strong>Check Docker status on nodes</strong></p>

<div class="highlight">
  <pre><code class="language-sh">docker ps
docker images
</code></pre>
</div>

<p><strong>After the pod is ‘Running’ Check web server access on the node</strong></p>

<div class="highlight">
  <pre><code class="language-sh">curl http://localhost
</code></pre>
</div>

<p>That’s it !</p>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/fedora/fedora_ansible_config.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



