<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Run Kubernetes with rkt</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Run Kubernetes with rkt</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h1 id="run-kubernetes-with-rkt">Run Kubernetes with rkt</h1>

<p>This document describes how to run Kubernetes using <a href="https://github.com/coreos/rkt">rkt</a> as a container runtime.
We still have <a href="http://issue.k8s.io/8262">a bunch of work</a> to do to make the experience with rkt wonderful, please stay tuned!</p>

<h3 id="prerequisite"><strong>Prerequisite</strong></h3>

<ul>
  <li>
    <p><a href="http://www.freedesktop.org/wiki/Software/systemd/">systemd</a> should be installed on the machine and should be enabled. The minimum version required at this moment (2015/09/01) is 219
<em>(Note that systemd is not required by rkt itself, we are using it here to monitor and manage the pods launched by kubelet.)</em></p>
  </li>
  <li>
    <p>Install the latest rkt release according to the instructions <a href="https://github.com/coreos/rkt">here</a>.
The minimum version required for now is <a href="https://github.com/coreos/rkt/releases/tag/v0.8.0">v0.8.0</a>.</p>
  </li>
  <li>
    <p>Note that for rkt version later than v0.7.0, <code>metadata service</code> is not required for running pods in private networks. So now rkt pods will not register the metadata service be default.</p>
  </li>
</ul>

<h3 id="local-cluster">Local cluster</h3>

<p>To use rkt as the container runtime, we need to supply <code>--container-runtime=rkt</code> and <code>--rkt-path=$PATH_TO_RKT_BINARY</code> to kubelet. Additionally we can provide <code>--rkt-stage1-image</code> flag
as well to select which <a href="https://github.com/coreos/rkt/blob/master/Documentation/running-lkvm-stage1.md">stage1 image</a> we want to use.</p>

<p>If you are using the <a href="https://releases.k8s.io/release-1.1/hack/local-up-cluster.sh">hack/local-up-cluster.sh</a> script to launch the local cluster, then you can edit the environment variable <code>CONTAINER_RUNTIME</code>, <code>RKT_PATH</code> and <code>RKT_STAGE1_IMAGE</code> to
set these flags:</p>

<div class="highlight">
  <pre><code class="language-console">$ export CONTAINER_RUNTIME=rkt
$ export RKT_PATH=$PATH_TO_RKT_BINARY
$ export RKT_STAGE1_IMAGE=PATH=$PATH_TO_STAGE1_IMAGE
</code></pre>
</div>

<p>Then we can launch the local cluster using the script:</p>

<div class="highlight">
  <pre><code class="language-console">$ hack/local-up-cluster.sh
</code></pre>
</div>

<h3 id="coreos-cluster-on-google-compute-engine-gce">CoreOS cluster on Google Compute Engine (GCE)</h3>

<p>To use rkt as the container runtime for your CoreOS cluster on GCE, you need to specify the OS distribution, project, image:</p>

<div class="highlight">
  <pre><code class="language-console">$ export KUBE_OS_DISTRIBUTION=coreos
$ export KUBE_GCE_MINION_IMAGE=&lt;image_id&gt;
$ export KUBE_GCE_MINION_PROJECT=coreos-cloud
$ export KUBE_CONTAINER_RUNTIME=rkt
</code></pre>
</div>

<p>You can optionally choose the version of rkt used by setting <code>KUBE_RKT_VERSION</code>:</p>

<div class="highlight">
  <pre><code class="language-console">$ export KUBE_RKT_VERSION=0.8.0
</code></pre>
</div>

<p>Then you can launch the cluster by:</p>

<div class="highlight">
  <pre><code class="language-console">$ kube-up.sh
</code></pre>
</div>

<p>Note that we are still working on making all containerized the master components run smoothly in rkt. Before that we are not able to run the master node with rkt yet.</p>

<h3 id="coreos-cluster-on-aws">CoreOS cluster on AWS</h3>

<p>To use rkt as the container runtime for your CoreOS cluster on AWS, you need to specify the provider and OS distribution:</p>

<div class="highlight">
  <pre><code class="language-console">$ export KUBERNETES_PROVIDER=aws
$ export KUBE_OS_DISTRIBUTION=coreos
$ export KUBE_CONTAINER_RUNTIME=rkt
</code></pre>
</div>

<p>You can optionally choose the version of rkt used by setting <code>KUBE_RKT_VERSION</code>:</p>

<div class="highlight">
  <pre><code class="language-console">$ export KUBE_RKT_VERSION=0.8.0
</code></pre>
</div>

<p>You can optionally choose the CoreOS channel  by setting <code>COREOS_CHANNEL</code>:</p>

<div class="highlight">
  <pre><code class="language-console">$ export COREOS_CHANNEL=stable
</code></pre>
</div>

<p>Then you can launch the cluster by:</p>

<div class="highlight">
  <pre><code class="language-console">$ kube-up.sh
</code></pre>
</div>

<p>Note: CoreOS is not supported as the master using the automated launch
scripts. The master node is always Ubuntu.</p>

<h3 id="getting-started-with-your-cluster">Getting started with your cluster</h3>

<p>See <a href="../../../docs/user-guide/simple-nginx.html">a simple nginx example</a> to try out your new cluster.</p>

<p>For more complete applications, please look in the <a href="../../../examples/">examples directory</a>.</p>

<h3 id="debugging">Debugging</h3>

<p>Here are severals tips for you when you run into any issues.</p>

<h5 id="check-logs">Check logs</h5>

<p>By default, the log verbose level is 2. In order to see more logs related to rkt, we can set the verbose level to 4.
For local cluster, we can set the environment variable: <code>LOG_LEVEL=4</code>.
If the cluster is using salt, we can edit the <a href="https://releases.k8s.io/release-1.1/cluster/saltbase/pillar/logging.sls">logging.sls</a> in the saltbase.</p>

<h5 id="check-rkt-pod-status">Check rkt pod status</h5>

<p>To check the pods’ status, we can use rkt command, such as <code>rkt list</code>, <code>rkt status</code>, <code>rkt image list</code>, etc.
More information about rkt command line can be found <a href="https://github.com/coreos/rkt/blob/master/Documentation/commands.md">here</a></p>

<h5 id="check-journal-logs">Check journal logs</h5>

<p>As we use systemd to launch rkt pods(by creating service files which will run <code>rkt run-prepared</code>, we can check the pods’ log
using <code>journalctl</code>:</p>

<ul>
  <li>Check the running state of the systemd service:</li>
</ul>

<div class="highlight">
  <pre><code class="language-console">$ sudo journalctl -u $SERVICE_FILE
</code></pre>
</div>

<p>where <code>$SERVICE_FILE</code> is the name of the service file created for the pod, you can find it in the kubelet logs.</p>

<h5 id="check-the-log-of-the-container-in-the-pod">Check the log of the container in the pod:</h5>

<div class="highlight">
  <pre><code class="language-console">$ sudo journalctl -M rkt-$UUID -u $CONTAINER_NAME
</code></pre>
</div>

<p>where <code>$UUID</code> is the rkt pod’s UUID, which you can find via <code>rkt list --full</code>, and <code>$CONTAINER_NAME</code> is the container’s name.</p>

<h5 id="check-kubernetes-events-logs">Check Kubernetes events, logs.</h5>

<p>Besides above tricks, Kubernetes also provides us handy tools for debugging the pods. More information can be found <a href="../../../docs/user-guide/application-troubleshooting.html">here</a></p>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/rkt/README.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



