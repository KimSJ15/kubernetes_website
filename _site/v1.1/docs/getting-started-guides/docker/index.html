<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Running Kubernetes locally via Docker</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/guides">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Running Kubernetes locally via Docker</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->
<p>Running Kubernetes locally via Docker
————————————-</p>

<p><strong>Table of Contents</strong></p>

<ul>
  <li><a href="#setting-up-a-cluster">Overview</a></li>
  <li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#step-one-run-etcd">Step One: Run etcd</a></li>
  <li><a href="#step-two-run-the-master">Step Two: Run the master</a></li>
  <li><a href="#step-three-run-the-service-proxy">Step Three: Run the service proxy</a></li>
  <li><a href="#test-it-out">Test it out</a></li>
  <li><a href="#run-an-application">Run an application</a></li>
  <li><a href="#expose-it-as-a-service">Expose it as a service</a></li>
  <li><a href="#a-note-on-turning-down-your-cluster">A note on turning down your cluster</a></li>
</ul>

<h3 id="overview">Overview</h3>

<p>The following instructions show you how to set up a simple, single node Kubernetes cluster using Docker.</p>

<p>Here’s a diagram of what the final result will look like:
<img src="k8s-singlenode-docker.png" alt="Kubernetes Single Node on Docker" /></p>

<h3 id="prerequisites">Prerequisites</h3>

<ol>
  <li>You need to have docker installed on one machine.</li>
  <li>Your kernel should support memory and swap accounting. Ensure that the
following configs are turned on in your linux kernel:</li>
</ol>

<div class="highlight">
  <pre><code class="language-console">CONFIG_RESOURCE_COUNTERS=y
    CONFIG_MEMCG=y
    CONFIG_MEMCG_SWAP=y
    CONFIG_MEMCG_SWAP_ENABLED=y
    CONFIG_MEMCG_KMEM=y
</code></pre>
</div>

<ol>
  <li>Enable the memory and swap accounting in the kernel, at boot, as command line
parameters as follows:</li>
</ol>

<div class="highlight">
  <pre><code class="language-console">GRUB_CMDLINE_LINUX="cgroup_enable=memory swapaccount=1"
</code></pre>
</div>

<pre><code>NOTE: The above is specifically for GRUB2.
You can check the command line parameters passed to your kernel by looking at the
output of /proc/cmdline:
</code></pre>

<div class="highlight">
  <pre><code class="language-console">$cat /proc/cmdline
    BOOT_IMAGE=/boot/vmlinuz-3.18.4-aufs root=/dev/sda5 ro cgroup_enable=memory
    swapaccount=1
</code></pre>
</div>

<h3 id="step-one-run-etcd">Step One: Run etcd</h3>

<div class="highlight">
  <pre><code class="language-sh">docker run --net=host -d gcr.io/google_containers/etcd:2.0.12 /usr/local/bin/etcd --addr=127.0.0.1:4001 --bind-addr=0.0.0.0:4001 --data-dir=/var/etcd/data
</code></pre>
</div>

<h3 id="step-two-run-the-master">Step Two: Run the master</h3>

<div class="highlight">
  <pre><code class="language-sh">docker run \
    --volume=/:/rootfs:ro \
    --volume=/sys:/sys:ro \
    --volume=/dev:/dev \
    --volume=/var/lib/docker/:/var/lib/docker:ro \
    --volume=/var/lib/kubelet/:/var/lib/kubelet:rw \
    --volume=/var/run:/var/run:rw \
    --net=host \
    --pid=host \
    --privileged=true \
    -d \
    gcr.io/google_containers/hyperkube:v1.0.1 \
    /hyperkube kubelet --containerized --hostname-override="127.0.0.1" --address="0.0.0.0" --api-servers=http://localhost:8080 --config=/etc/kubernetes/manifests
</code></pre>
</div>

<p>This actually runs the kubelet, which in turn runs a <a href="../user-guide/pods.html">pod</a> that contains the other master components.</p>

<h3 id="step-three-run-the-service-proxy">Step Three: Run the service proxy</h3>

<div class="highlight">
  <pre><code class="language-sh">docker run -d --net=host --privileged gcr.io/google_containers/hyperkube:v1.0.1 /hyperkube proxy --master=http://127.0.0.1:8080 --v=2
</code></pre>
</div>

<h3 id="test-it-out">Test it out</h3>

<p>At this point you should have a running Kubernetes cluster.  You can test this by downloading the kubectl
binary
(<a href="https://storage.googleapis.com/kubernetes-release/release/v1.0.1/bin/darwin/amd64/kubectl">OS X</a>)
(<a href="https://storage.googleapis.com/kubernetes-release/release/v1.0.1/bin/linux/amd64/kubectl">linux</a>)</p>

<p><em>Note:</em>
On OS/X you will need to set up port forwarding via ssh:</p>

<div class="highlight">
  <pre><code class="language-sh">boot2docker ssh -L8080:localhost:8080
</code></pre>
</div>

<p>List the nodes in your cluster by running:</p>

<div class="highlight">
  <pre><code class="language-sh">kubectl get nodes
</code></pre>
</div>

<p>This should print:</p>

<div class="highlight">
  <pre><code class="language-console">NAME        LABELS    STATUS
127.0.0.1   &lt;none&gt;    Ready
</code></pre>
</div>

<p>If you are running different Kubernetes clusters, you may need to specify <code>-s http://localhost:8080</code> to select the local cluster.</p>

<h3 id="run-an-application">Run an application</h3>

<div class="highlight">
  <pre><code class="language-sh">kubectl -s http://localhost:8080 run nginx --image=nginx --port=80
</code></pre>
</div>

<p>Now run <code>docker ps</code> you should see nginx running.  You may need to wait a few minutes for the image to get pulled.</p>

<h3 id="expose-it-as-a-service">Expose it as a service</h3>

<div class="highlight">
  <pre><code class="language-sh">kubectl expose rc nginx --port=80
</code></pre>
</div>

<p>Run the following command to obtain the IP of this service we just created. There are two IPs, the first one is internal (CLUSTER_IP), and the second one is the external load-balanced IP.</p>

<div class="highlight">
  <pre><code class="language-sh">kubectl get svc nginx
</code></pre>
</div>

<p>Alternatively, you can obtain only the first IP (CLUSTER_IP) by running:</p>

<div class="highlight">
  <pre><code class="language-sh">kubectl get svc nginx --template={{.spec.clusterIP}}
</code></pre>
</div>

<p>Hit the webserver with the first IP (CLUSTER_IP):</p>

<div class="highlight">
  <pre><code class="language-sh">curl &lt;insert-cluster-ip-here&gt;
</code></pre>
</div>

<p>Note that you will need run this curl command on your boot2docker VM if you are running on OS X.</p>

<h3 id="a-note-on-turning-down-your-cluster">A note on turning down your cluster</h3>

<p>Many of these containers run under the management of the <code>kubelet</code> binary, which attempts to keep containers running, even if they fail.  So, in order to turn down
the cluster, you need to first kill the kubelet container, and then any other containers.</p>

<p>You may use <code>docker kill $(docker ps -aq)</code>, note this removes <em>all</em> containers running under Docker, so use with caution.</p>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/docker.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



