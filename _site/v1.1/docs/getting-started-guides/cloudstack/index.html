<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Getting started on CloudStack</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/guides">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Getting started on CloudStack</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->
<p>Getting started on <a href="http://cloudstack.apache.org">CloudStack</a>
————————————————————</p>

<p><strong>Table of Contents</strong></p>

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#clone-the-playbook">Clone the playbook</a></li>
  <li><a href="#create-a-kubernetes-cluster">Create a Kubernetes cluster</a></li>
</ul>

<h3 id="introduction">Introduction</h3>

<p>CloudStack is a software to build public and private clouds based on hardware virtualization principles (traditional IaaS). To deploy Kubernetes on CloudStack there are several possibilities depending on the Cloud being used and what images are made available. <a href="http://exoscale.ch">Exoscale</a> for instance makes a <a href="http://coreos.com">CoreOS</a> template available, therefore instructions to deploy Kubernetes on coreOS can be used. CloudStack also has a vagrant plugin available, hence Vagrant could be used to deploy Kubernetes either using the existing shell provisioner or using new Salt based recipes.</p>

<p><a href="http://coreos.com">CoreOS</a> templates for CloudStack are built <a href="http://stable.release.core-os.net/amd64-usr/current/">nightly</a>. CloudStack operators need to <a href="http://docs.cloudstack.apache.org/projects/cloudstack-administration/en/latest/templates.html">register</a> this template in their cloud before proceeding with these Kubernetes deployment instructions.</p>

<p>This guide uses an <a href="https://github.com/runseb/ansible-kubernetes">Ansible playbook</a>.
This is a completely automated, a single playbook deploys Kubernetes based on the coreOS <a href="coreos/coreos_multinode_cluster.html">instructions</a>.</p>

<p>This <a href="http://ansibleworks.com">Ansible</a> playbook deploys Kubernetes on a CloudStack based Cloud using CoreOS images. The playbook, creates an ssh key pair, creates a security group and associated rules and finally starts coreOS instances configured via cloud-init.</p>

<h3 id="prerequisites">Prerequisites</h3>

<pre><code>$ sudo apt-get install -y python-pip
$ sudo pip install ansible
$ sudo pip install cs
</code></pre>

<p><a href="https://github.com/exoscale/cs"><em>cs</em></a> is a python module for the CloudStack API.</p>

<p>Set your CloudStack endpoint, API keys and HTTP method used.</p>

<p>You can define them as environment variables: <code>CLOUDSTACK_ENDPOINT</code>, <code>CLOUDSTACK_KEY</code>, <code>CLOUDSTACK_SECRET</code> and <code>CLOUDSTACK_METHOD</code>.</p>

<p>Or create a <code>~/.cloudstack.ini</code> file:</p>

<pre><code>[cloudstack]
endpoint = &lt;your cloudstack api endpoint&gt;
key = &lt;your api access key&gt;
secret = &lt;your api secret key&gt;
method = post
</code></pre>

<p>We need to use the http POST method to pass the <em>large</em> userdata to the coreOS instances.</p>

<h3 id="clone-the-playbook">Clone the playbook</h3>

<pre><code>$ git clone --recursive https://github.com/runseb/ansible-kubernetes.git
$ cd ansible-kubernetes
</code></pre>

<p>The <a href="https://github.com/resmo/ansible-cloudstack">ansible-cloudstack</a> module is setup in this repository as a submodule, hence the <code>--recursive</code>.</p>

<h3 id="create-a-kubernetes-cluster">Create a Kubernetes cluster</h3>

<p>You simply need to run the playbook.</p>

<pre><code>$ ansible-playbook k8s.yml
</code></pre>

<p>Some variables can be edited in the <code>k8s.yml</code> file.</p>

<pre><code>vars:
  ssh_key: k8s
  k8s_num_nodes: 2
  k8s_security_group_name: k8s
  k8s_node_prefix: k8s2
  k8s_template: Linux CoreOS alpha 435 64-bit 10GB Disk
  k8s_instance_type: Tiny
</code></pre>

<p>This will start a Kubernetes master node and a number of compute nodes (by default 2).
The <code>instance_type</code> and <code>template</code> by default are specific to <a href="http://exoscale.ch">exoscale</a>, edit them to specify your CloudStack cloud specific template and instance type (i.e service offering).</p>

<p>Check the tasks and templates in <code>roles/k8s</code> if you want to modify anything.</p>

<p>Once the playbook as finished, it will print out the IP of the Kubernetes master:</p>

<pre><code>TASK: [k8s | debug msg='k8s master IP is '] ********
</code></pre>

<p>SSH to it using the key that was created and using the <em>core</em> user and you can list the machines in your cluster:</p>

<pre><code>$ ssh -i ~/.ssh/id_rsa_k8s core@&lt;master IP&gt;
$ fleetctl list-machines
MACHINE		IP		       METADATA
a017c422...	&lt;node #1 IP&gt;   role=node
ad13bf84...	&lt;master IP&gt;	   role=master
e9af8293...	&lt;node #2 IP&gt;   role=node
</code></pre>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/cloudstack.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



