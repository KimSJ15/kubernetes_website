<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Getting started with Vagrant</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Getting started with Vagrant</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h2 id="getting-started-with-vagrant">Getting started with Vagrant</h2>

<p>Running kubernetes with Vagrant (and VirtualBox) is an easy way to run/test/develop on your local machine (Linux, Mac OS X).</p>

<h3 id="prerequisites">Prerequisites</h3>

<ol>
  <li>Install latest version &gt;= 1.6.2 of vagrant from http://www.vagrantup.com/downloads.html</li>
  <li>Install one of:
    <ol>
      <li>The latest version of Virtual Box from https://www.virtualbox.org/wiki/Downloads</li>
      <li><a href="https://www.vmware.com/products/fusion/">VMWare Fusion</a> version 5 or greater as well as the appropriate <a href="https://www.vagrantup.com/vmware">Vagrant VMWare Fusion provider</a></li>
      <li><a href="https://www.vmware.com/products/workstation/">VMWare Workstation</a> version 9 or greater as well as the <a href="https://www.vagrantup.com/vmware">Vagrant VMWare Workstation provider</a></li>
      <li><a href="https://www.parallels.com/products/desktop/">Parallels Desktop</a> version 9 or greater as well as the <a href="https://parallels.github.io/vagrant-parallels/">Vagrant Parallels provider</a></li>
    </ol>
  </li>
  <li>Get or build a <a href="../../../docs/getting-started-guides/binary_release.html">binary release</a></li>
</ol>

<h3 id="setup">Setup</h3>

<p>By default, the Vagrant setup will create a single master VM (called kubernetes-master) and one node (called kubernetes-minion-1). Each VM will take 1 GB, so make sure you have at least 2GB to 4GB of free memory (plus appropriate free disk space). To start your local cluster, open a shell and run:</p>

<div class="highlight">
  <pre><code class="language-sh">cd kubernetes

export KUBERNETES_PROVIDER=vagrant
./cluster/kube-up.sh
</code></pre>
</div>

<p>The <code>KUBERNETES_PROVIDER</code> environment variable tells all of the various cluster management scripts which variant to use.  If you forget to set this, the assumption is you are running on Google Compute Engine.</p>

<p>If you installed more than one Vagrant provider, Kubernetes will usually pick the appropriate one. However, you can override which one Kubernetes will use by setting the <a href="https://docs.vagrantup.com/v2/providers/default.html"><code>VAGRANT_DEFAULT_PROVIDER</code></a> environment variable:</p>

<div class="highlight">
  <pre><code class="language-sh">export VAGRANT_DEFAULT_PROVIDER=parallels
export KUBERNETES_PROVIDER=vagrant
./cluster/kube-up.sh
</code></pre>
</div>

<p>Vagrant will provision each machine in the cluster with all the necessary components to run Kubernetes.  The initial setup can take a few minutes to complete on each machine.</p>

<p>By default, each VM in the cluster is running Fedora, and all of the Kubernetes services are installed into systemd.</p>

<p>To access the master or any node:</p>

<div class="highlight">
  <pre><code class="language-sh">vagrant ssh master
vagrant ssh minion-1
</code></pre>
</div>

<p>If you are running more than one nodes, you can access the others by:</p>

<div class="highlight">
  <pre><code class="language-sh">vagrant ssh minion-2
vagrant ssh minion-3
</code></pre>
</div>

<p>To view the service status and/or logs on the kubernetes-master:</p>

<div class="highlight">
  <pre><code class="language-console">$ vagrant ssh master
[vagrant@kubernetes-master ~] $ sudo systemctl status kube-apiserver
[vagrant@kubernetes-master ~] $ sudo journalctl -r -u kube-apiserver

[vagrant@kubernetes-master ~] $ sudo systemctl status kube-controller-manager
[vagrant@kubernetes-master ~] $ sudo journalctl -r -u kube-controller-manager

[vagrant@kubernetes-master ~] $ sudo systemctl status etcd
[vagrant@kubernetes-master ~] $ sudo systemctl status nginx
</code></pre>
</div>

<p>To view the services on any of the nodes:</p>

<div class="highlight">
  <pre><code class="language-console">$ vagrant ssh minion-1
[vagrant@kubernetes-minion-1] $ sudo systemctl status docker
[vagrant@kubernetes-minion-1] $ sudo journalctl -r -u docker
[vagrant@kubernetes-minion-1] $ sudo systemctl status kubelet
[vagrant@kubernetes-minion-1] $ sudo journalctl -r -u kubelet
</code></pre>
</div>

<h3 id="interacting-with-your-kubernetes-cluster-with-vagrant">Interacting with your Kubernetes cluster with Vagrant.</h3>

<p>With your Kubernetes cluster up, you can manage the nodes in your cluster with the regular Vagrant commands.</p>

<p>To push updates to new Kubernetes code after making source changes:</p>

<div class="highlight">
  <pre><code class="language-sh">./cluster/kube-push.sh
</code></pre>
</div>

<p>To stop and then restart the cluster:</p>

<div class="highlight">
  <pre><code class="language-sh">vagrant halt
./cluster/kube-up.sh
</code></pre>
</div>

<p>To destroy the cluster:</p>

<div class="highlight">
  <pre><code class="language-sh">vagrant destroy
</code></pre>
</div>

<p>Once your Vagrant machines are up and provisioned, the first thing to do is to check that you can use the <code>kubectl.sh</code> script.</p>

<p>You may need to build the binaries first, you can do this with <code>make</code></p>

<div class="highlight">
  <pre><code class="language-console">$ ./cluster/kubectl.sh get nodes

NAME                     LABELS                                          STATUS
kubernetes-minion-0whl   kubernetes.io/hostname=kubernetes-minion-0whl   Ready
kubernetes-minion-4jdf   kubernetes.io/hostname=kubernetes-minion-4jdf   Ready
kubernetes-minion-epbe   kubernetes.io/hostname=kubernetes-minion-epbe   Ready
</code></pre>
</div>

<h3 id="interacting-with-your-kubernetes-cluster-with-the-kube--scripts">Interacting with your Kubernetes cluster with the <code>kube-*</code> scripts.</h3>

<p>Alternatively to using the vagrant commands, you can also use the <code>cluster/kube-*.sh</code> scripts to interact with the vagrant based provider just like any other hosting platform for kubernetes.</p>

<p>All of these commands assume you have set <code>KUBERNETES_PROVIDER</code> appropriately:</p>

<div class="highlight">
  <pre><code class="language-sh">export KUBERNETES_PROVIDER=vagrant
</code></pre>
</div>

<p>Bring up a vagrant cluster</p>

<div class="highlight">
  <pre><code class="language-sh">./cluster/kube-up.sh
</code></pre>
</div>

<p>Destroy the vagrant cluster</p>

<div class="highlight">
  <pre><code class="language-sh">./cluster/kube-down.sh
</code></pre>
</div>

<p>Update the vagrant cluster after you make changes (only works when building your own releases locally):</p>

<div class="highlight">
  <pre><code class="language-sh">./cluster/kube-push.sh
</code></pre>
</div>

<p>Interact with the cluster</p>

<div class="highlight">
  <pre><code class="language-sh">./cluster/kubectl.sh
</code></pre>
</div>

<h3 id="authenticating-with-your-master">Authenticating with your master</h3>

<p>When using the vagrant provider in Kubernetes, the <code>cluster/kubectl.sh</code> script will cache your credentials in a <code>~/.kubernetes_vagrant_auth</code> file so you will not be prompted for them in the future.</p>

<div class="highlight">
  <pre><code class="language-console">$ cat ~/.kubernetes_vagrant_auth
{ "User": "vagrant",
  "Password": "vagrant"
  "CAFile": "/home/k8s_user/.kubernetes.vagrant.ca.crt",
  "CertFile": "/home/k8s_user/.kubecfg.vagrant.crt",
  "KeyFile": "/home/k8s_user/.kubecfg.vagrant.key"
}
</code></pre>
</div>

<p>You should now be set to use the <code>cluster/kubectl.sh</code> script. For example try to list the nodes that you have started with:</p>

<div class="highlight">
  <pre><code class="language-sh">./cluster/kubectl.sh get nodes
</code></pre>
</div>

<h3 id="running-containers">Running containers</h3>

<p>Your cluster is running, you can list the nodes in your cluster:</p>

<div class="highlight">
  <pre><code class="language-console">$ ./cluster/kubectl.sh get nodes

NAME                     LABELS                                          STATUS
kubernetes-minion-0whl   kubernetes.io/hostname=kubernetes-minion-0whl   Ready
kubernetes-minion-4jdf   kubernetes.io/hostname=kubernetes-minion-4jdf   Ready
kubernetes-minion-epbe   kubernetes.io/hostname=kubernetes-minion-epbe   Ready
</code></pre>
</div>

<p>Now start running some containers!</p>

<p>You can now use any of the cluster/kube-*.sh commands to interact with your VM machines.
Before starting a container there will be no pods, services and replication controllers.</p>

<div class="highlight">
  <pre><code class="language-console">$ cluster/kubectl.sh get pods
NAME  READY   STATUS    RESTARTS    AGE

$ cluster/kubectl.sh get services
NAME  LABELS   SELECTOR    IP(S)    PORT(S)

$ cluster/kubectl.sh get rc
CONTROLLER  CONTAINER(S)   IMAGE(S)    SELECTOR    REPLICAS
</code></pre>
</div>

<p>Start a container running nginx with a replication controller and three replicas</p>

<div class="highlight">
  <pre><code class="language-console">$ cluster/kubectl.sh run my-nginx --image=nginx --replicas=3 --port=80
CONTROLLER   CONTAINER(S)   IMAGE(S)   SELECTOR       REPLICAS
my-nginx     my-nginx       nginx      run=my-nginx   3
</code></pre>
</div>

<p>When listing the pods, you will see that three containers have been started and are in Waiting state:</p>

<div class="highlight">
  <pre><code class="language-console">$ cluster/kubectl.sh get pods
NAME              READY     STATUS    RESTARTS   AGE
my-nginx-389da    1/1       Waiting   0          33s
my-nginx-kqdjk    1/1       Waiting   0          33s
my-nginx-nyj3x    1/1       Waiting   0          33s
</code></pre>
</div>

<p>You need to wait for the provisioning to complete, you can monitor the minions by doing:</p>

<div class="highlight">
  <pre><code class="language-console">$ sudo salt '*minion-1' cmd.run 'docker images'
kubernetes-minion-1:
    REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
    &lt;none&gt;              &lt;none&gt;              96864a7d2df3        26 hours ago        204.4 MB
    kubernetes/pause    latest              6c4579af347b        8 weeks ago         239.8 kB
</code></pre>
</div>

<p>Once the docker image for nginx has been downloaded, the container will start and you can list it:</p>

<div class="highlight">
  <pre><code class="language-console">$ sudo salt '*minion-1' cmd.run 'docker ps'
kubernetes-minion-1:
    CONTAINER ID        IMAGE                     COMMAND                CREATED             STATUS              PORTS                    NAMES
    dbe79bf6e25b        nginx:latest              "nginx"                21 seconds ago      Up 19 seconds                                k8s--mynginx.8c5b8a3a--7813c8bd_-_3ffe_-_11e4_-_9036_-_0800279696e1.etcd--7813c8bd_-_3ffe_-_11e4_-_9036_-_0800279696e1--fcfa837f
    fa0e29c94501        kubernetes/pause:latest   "/pause"               8 minutes ago       Up 8 minutes        0.0.0.0:8080-&gt;80/tcp     k8s--net.a90e7ce4--7813c8bd_-_3ffe_-_11e4_-_9036_-_0800279696e1.etcd--7813c8bd_-_3ffe_-_11e4_-_9036_-_0800279696e1--baf5b21b
</code></pre>
</div>

<p>Going back to listing the pods, services and replicationcontrollers, you now have:</p>

<div class="highlight">
  <pre><code class="language-console">$ cluster/kubectl.sh get pods
NAME              READY     STATUS    RESTARTS   AGE
my-nginx-389da    1/1       Running   0          33s
my-nginx-kqdjk    1/1       Running   0          33s
my-nginx-nyj3x    1/1       Running   0          33s

$ cluster/kubectl.sh get services
NAME   LABELS   SELECTOR   IP(S)   PORT(S)

$ cluster/kubectl.sh get rc
NAME        IMAGE(S)          SELECTOR       REPLICAS
my-nginx    nginx             run=my-nginx   3
</code></pre>
</div>

<p>We did not start any services, hence there are none listed. But we see three replicas displayed properly.
Check the <a href="../../../examples/guestbook/README.html">guestbook</a> application to learn how to create a service.
You can already play with scaling the replicas with:</p>

<div class="highlight">
  <pre><code class="language-console">$ ./cluster/kubectl.sh scale rc my-nginx --replicas=2
$ ./cluster/kubectl.sh get pods
NAME              READY     STATUS    RESTARTS   AGE
my-nginx-kqdjk    1/1       Running   0          13m
my-nginx-nyj3x    1/1       Running   0          13m
</code></pre>
</div>

<p>Congratulations!</p>

<h3 id="testing">Testing</h3>

<p>The following will run all of the end-to-end testing scenarios assuming you set your environment in <code>cluster/kube-env.sh</code>:</p>

<div class="highlight">
  <pre><code class="language-sh">NUM_MINIONS=3 hack/e2e-test.sh
</code></pre>
</div>

<h3 id="troubleshooting">Troubleshooting</h3>

<h4 id="i-keep-downloading-the-same-large-box-all-the-time">I keep downloading the same (large) box all the time!</h4>

<p>By default the Vagrantfile will download the box from S3. You can change this (and cache the box locally) by providing a name and an alternate URL when calling <code>kube-up.sh</code></p>

<div class="highlight">
  <pre><code class="language-sh">export KUBERNETES_BOX_NAME=choose_your_own_name_for_your_kuber_box
export KUBERNETES_BOX_URL=path_of_your_kuber_box
export KUBERNETES_PROVIDER=vagrant
./cluster/kube-up.sh
</code></pre>
</div>

<h4 id="i-just-created-the-cluster-but-i-am-getting-authorization-errors">I just created the cluster, but I am getting authorization errors!</h4>

<p>You probably have an incorrect ~/.kubernetes_vagrant_auth file for the cluster you are attempting to contact.</p>

<div class="highlight">
  <pre><code class="language-sh">rm ~/.kubernetes_vagrant_auth
</code></pre>
</div>

<p>After using kubectl.sh make sure that the correct credentials are set:</p>

<div class="highlight">
  <pre><code class="language-console">$ cat ~/.kubernetes_vagrant_auth
{
  "User": "vagrant",
  "Password": "vagrant"
}
</code></pre>
</div>

<h4 id="i-just-created-the-cluster-but-i-do-not-see-my-container-running">I just created the cluster, but I do not see my container running!</h4>

<p>If this is your first time creating the cluster, the kubelet on each node schedules a number of docker pull requests to fetch prerequisite images.  This can take some time and as a result may delay your initial pod getting provisioned.</p>

<h4 id="i-changed-kubernetes-code-but-its-not-running">I changed Kubernetes code, but it’s not running!</h4>

<p>Are you sure there was no build error?  After running <code>$ vagrant provision</code>, scroll up and ensure that each Salt state was completed successfully on each box in the cluster.
It’s very likely you see a build error due to an error in your source files!</p>

<h4 id="i-have-brought-vagrant-up-but-the-nodes-wont-validate">I have brought Vagrant up but the nodes won’t validate!</h4>

<p>Are you sure you built a release first? Did you install <code>net-tools</code>? For more clues, login to one of the nodes (<code>vagrant ssh minion-1</code>) and inspect the salt minion log (<code>sudo cat /var/log/salt/minion</code>).</p>

<h4 id="i-want-to-change-the-number-of-nodes">I want to change the number of nodes!</h4>

<p>You can control the number of nodes that are instantiated via the environment variable <code>NUM_MINIONS</code> on your host machine.  If you plan to work with replicas, we strongly encourage you to work with enough nodes to satisfy your largest intended replica size.  If you do not plan to work with replicas, you can save some system resources by running with a single node. You do this, by setting <code>NUM_MINIONS</code> to 1 like so:</p>

<div class="highlight">
  <pre><code class="language-sh">export NUM_MINIONS=1
</code></pre>
</div>

<h4 id="i-want-my-vms-to-have-more-memory">I want my VMs to have more memory!</h4>

<p>You can control the memory allotted to virtual machines with the <code>KUBERNETES_MEMORY</code> environment variable.
Just set it to the number of megabytes you would like the machines to have. For example:</p>

<div class="highlight">
  <pre><code class="language-sh">export KUBERNETES_MEMORY=2048
</code></pre>
</div>

<p>If you need more granular control, you can set the amount of memory for the master and nodes independently. For example:</p>

<div class="highlight">
  <pre><code class="language-sh">export KUBERNETES_MASTER_MEMORY=1536
export KUBERNETES_MINION_MEMORY=2048
</code></pre>
</div>

<h4 id="i-ran-vagrant-suspend-and-nothing-works">I ran vagrant suspend and nothing works!</h4>

<p><code>vagrant suspend</code> seems to mess up the network.  It’s not supported at this time.</p>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/devel/developer-guides/vagrant.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



