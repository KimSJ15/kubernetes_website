<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Development Guide</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Development Guide</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h1 id="development-guide">Development Guide</h1>

<h1 id="releases-and-official-builds">Releases and Official Builds</h1>

<p>Official releases are built in Docker containers.  Details are <a href="http://releases.k8s.io/release-1.1/build/README.md">here</a>.  You can do simple builds and development with just a local Docker installation.  If want to build go locally outside of docker, please continue below.</p>

<h2 id="go-development-environment">Go development environment</h2>

<p>Kubernetes is written in <a href="http://golang.org">Go</a> programming language. If you haven’t set up Go development environment, please follow <a href="http://golang.org/doc/code.html">this instruction</a> to install go tool and set up GOPATH. Ensure your version of Go is at least 1.3.</p>

<h2 id="git-setup">Git Setup</h2>

<p>Below, we outline one of the more common git workflows that core developers use. Other git workflows are also valid.</p>

<h3 id="visual-overview">Visual overview</h3>

<p><img src="git_workflow.png" alt="Git workflow" /></p>

<h3 id="fork-the-main-repository">Fork the main repository</h3>

<ol>
  <li>Go to https://github.com/kubernetes/kubernetes</li>
  <li>Click the “Fork” button (at the top right)</li>
</ol>

<h3 id="clone-your-fork">Clone your fork</h3>

<p>The commands below require that you have $GOPATH set (<a href="https://golang.org/doc/code.html#GOPATH">$GOPATH docs</a>). We highly recommend you put Kubernetes’ code into your GOPATH. Note: the commands below will not work if there is more than one directory in your <code>$GOPATH</code>.</p>

<div class="highlight">
  <pre><code class="language-sh">mkdir -p $GOPATH/src/k8s.io
cd $GOPATH/src/k8s.io
# Replace "$YOUR_GITHUB_USERNAME" below with your github username
git clone https://github.com/$YOUR_GITHUB_USERNAME/kubernetes.git
cd kubernetes
git remote add upstream 'https://github.com/kubernetes/kubernetes.git'
</code></pre>
</div>

<h3 id="create-a-branch-and-make-changes">Create a branch and make changes</h3>

<div class="highlight">
  <pre><code class="language-sh">git checkout -b myfeature
# Make your code changes
</code></pre>
</div>

<h3 id="keeping-your-development-fork-in-sync">Keeping your development fork in sync</h3>

<div class="highlight">
  <pre><code class="language-sh">git fetch upstream
git rebase upstream/master
</code></pre>
</div>

<p>Note: If you have write access to the main repository at github.com/kubernetes/kubernetes, you should modify your git configuration so that you can’t accidentally push to upstream:</p>

<div class="highlight">
  <pre><code class="language-sh">git remote set-url --push upstream no_push
</code></pre>
</div>

<h3 id="committing-changes-to-your-fork">Committing changes to your fork</h3>

<div class="highlight">
  <pre><code class="language-sh">git commit
git push -f origin myfeature
</code></pre>
</div>

<h3 id="creating-a-pull-request">Creating a pull request</h3>

<ol>
  <li>Visit https://github.com/$YOUR_GITHUB_USERNAME/kubernetes</li>
  <li>Click the “Compare and pull request” button next to your “myfeature” branch.</li>
  <li>Check out the pull request <a href="pull-requests.html">process</a> for more details</li>
</ol>

<h3 id="when-to-retain-commits-and-when-to-squash">When to retain commits and when to squash</h3>

<p>Upon merge, all git commits should represent meaningful milestones or units of
work.  Use commits to add clarity to the development and review process.</p>

<p>Before merging a PR, squash any “fix review feedback”, “typo”, and “rebased”
sorts of commits.  It is not imperative that every commit in a PR compile and
pass tests independently, but it is worth striving for.  For mass automated
fixups (e.g. automated doc formatting), use one or more commits for the
changes to tooling and a final commit to apply the fixup en masse.  This makes
reviews much easier.</p>

<p>See <a href="faster_reviews.html">Faster Reviews</a> for more details.</p>

<h2 id="godep-and-dependency-management">godep and dependency management</h2>

<p>Kubernetes uses <a href="https://github.com/tools/godep">godep</a> to manage dependencies. It is not strictly required for building Kubernetes but it is required when managing dependencies under the Godeps/ tree, and is required by a number of the build and test scripts. Please make sure that <code>godep</code> is installed and in your <code>$PATH</code>.</p>

<h3 id="installing-godep">Installing godep</h3>

<p>There are many ways to build and host go binaries. Here is an easy way to get utilities like <code>godep</code> installed:</p>

<p>1) Ensure that <a href="http://mercurial.selenic.com/wiki/Download">mercurial</a> is installed on your system. (some of godep’s dependencies use the mercurial
source control system).  Use <code>apt-get install mercurial</code> or <code>yum install mercurial</code> on Linux, or <a href="http://brew.sh">brew.sh</a> on OS X, or download
directly from mercurial.</p>

<p>2) Create a new GOPATH for your tools and install godep:</p>

<div class="highlight">
  <pre><code class="language-sh">export GOPATH=$HOME/go-tools
mkdir -p $GOPATH
go get github.com/tools/godep
</code></pre>
</div>

<p>3) Add $GOPATH/bin to your path. Typically you’d add this to your ~/.profile:</p>

<div class="highlight">
  <pre><code class="language-sh">export GOPATH=$HOME/go-tools
export PATH=$PATH:$GOPATH/bin
</code></pre>
</div>

<h3 id="using-godep">Using godep</h3>

<p>Here’s a quick walkthrough of one way to use godeps to add or update a Kubernetes dependency into Godeps/_workspace. For more details, please see the instructions in <a href="https://github.com/tools/godep">godep’s documentation</a>.</p>

<p>1) Devote a directory to this endeavor:</p>

<p><em>Devoting a separate directory is not required, but it is helpful to separate dependency updates from other changes.</em></p>

<div class="highlight">
  <pre><code class="language-sh">export KPATH=$HOME/code/kubernetes
mkdir -p $KPATH/src/k8s.io/kubernetes
cd $KPATH/src/k8s.io/kubernetes
git clone https://path/to/your/fork .
# Or copy your existing local repo here. IMPORTANT: making a symlink doesn't work.
</code></pre>
</div>

<p>2) Set up your GOPATH.</p>

<div class="highlight">
  <pre><code class="language-sh"># Option A: this will let your builds see packages that exist elsewhere on your system.
export GOPATH=$KPATH:$GOPATH
# Option B: This will *not* let your local builds see packages that exist elsewhere on your system.
export GOPATH=$KPATH
# Option B is recommended if you're going to mess with the dependencies.
</code></pre>
</div>

<p>3) Populate your new GOPATH.</p>

<div class="highlight">
  <pre><code class="language-sh">cd $KPATH/src/k8s.io/kubernetes
godep restore
</code></pre>
</div>

<p>4) Next, you can either add a new dependency or update an existing one.</p>

<div class="highlight">
  <pre><code class="language-sh"># To add a new dependency, do:
cd $KPATH/src/k8s.io/kubernetes
go get path/to/dependency
# Change code in Kubernetes to use the dependency.
godep save ./...

# To update an existing dependency, do:
cd $KPATH/src/k8s.io/kubernetes
go get -u path/to/dependency
# Change code in Kubernetes accordingly if necessary.
godep update path/to/dependency/...
</code></pre>
</div>

<p><em>If <code>go get -u path/to/dependency</code> fails with compilation errors, instead try <code>go get -d -u path/to/dependency</code>
to fetch the dependencies without compiling them.  This can happen when updating the cadvisor dependency.</em></p>

<p>5) Before sending your PR, it’s a good idea to sanity check that your Godeps.json file is ok by running hack/verify-godeps.sh</p>

<p><em>If hack/verify-godeps.sh fails after a <code>godep update</code>, it is possible that a transitive dependency was added or removed but not
updated by godeps.  It then may be necessary to perform a <code>godep save ./...</code> to pick up the transitive dependency changes.</em></p>

<p>It is sometimes expedient to manually fix the /Godeps/godeps.json file to minimize the changes.</p>

<p>Please send dependency updates in separate commits within your PR, for easier reviewing.</p>

<h2 id="hooks">Hooks</h2>

<p>Before committing any changes, please link/copy these hooks into your .git
directory. This will keep you from accidentally committing non-gofmt’d go code.</p>

<div class="highlight">
  <pre><code class="language-sh">cd kubernetes/.git/hooks/
ln -s ../../hooks/pre-commit .
</code></pre>
</div>

<h2 id="unit-tests">Unit tests</h2>

<div class="highlight">
  <pre><code class="language-sh">cd kubernetes
hack/test-go.sh
</code></pre>
</div>

<p>Alternatively, you could also run:</p>

<div class="highlight">
  <pre><code class="language-sh">cd kubernetes
godep go test ./...
</code></pre>
</div>

<p>If you only want to run unit tests in one package, you could run <code>godep go test</code> under the package directory. For example, the following commands will run all unit tests in package kubelet:</p>

<div class="highlight">
  <pre><code class="language-console">$ cd kubernetes # step into the kubernetes directory.
$ cd pkg/kubelet
$ godep go test
# some output from unit tests
PASS
ok      k8s.io/kubernetes/pkg/kubelet   0.317s
</code></pre>
</div>

<h2 id="coverage">Coverage</h2>

<p>Currently, collecting coverage is only supported for the Go unit tests.</p>

<p>To run all unit tests and generate an HTML coverage report, run the following:</p>

<div class="highlight">
  <pre><code class="language-sh">cd kubernetes
KUBE_COVER=y hack/test-go.sh
</code></pre>
</div>

<p>At the end of the run, an the HTML report will be generated with the path printed to stdout.</p>

<p>To run tests and collect coverage in only one package, pass its relative path under the <code>kubernetes</code> directory as an argument, for example:</p>

<div class="highlight">
  <pre><code class="language-sh">cd kubernetes
KUBE_COVER=y hack/test-go.sh pkg/kubectl
</code></pre>
</div>

<p>Multiple arguments can be passed, in which case the coverage results will be combined for all tests run.</p>

<p>Coverage results for the project can also be viewed on <a href="https://coveralls.io/r/kubernetes/kubernetes">Coveralls</a>, and are continuously updated as commits are merged. Additionally, all pull requests which spawn a Travis build will report unit test coverage results to Coveralls. Coverage reports from before the Kubernetes Github organization was created can be found <a href="https://coveralls.io/r/GoogleCloudPlatform/kubernetes">here</a>.</p>

<h2 id="integration-tests">Integration tests</h2>

<p>You need an <a href="https://github.com/coreos/etcd/releases/tag/v2.0.0">etcd</a> in your path, please make sure it is installed and in your <code>$PATH</code>.</p>

<div class="highlight">
  <pre><code class="language-sh">cd kubernetes
hack/test-integration.sh
</code></pre>
</div>

<h2 id="end-to-end-tests">End-to-End tests</h2>

<p>You can run an end-to-end test which will bring up a master and two nodes, perform some tests, and then tear everything down. Make sure you have followed the getting started steps for your chosen cloud platform (which might involve changing the <code>KUBERNETES_PROVIDER</code> environment variable to something other than “gce”.</p>

<div class="highlight">
  <pre><code class="language-sh">cd kubernetes
hack/e2e-test.sh
</code></pre>
</div>

<p>Pressing control-C should result in an orderly shutdown but if something goes wrong and you still have some VMs running you can force a cleanup with this command:</p>

<div class="highlight">
  <pre><code class="language-sh">go run hack/e2e.go --down
</code></pre>
</div>

<h3 id="flag-options">Flag options</h3>

<p>See the flag definitions in <code>hack/e2e.go</code> for more options, such as reusing an existing cluster, here is an overview:</p>

<div class="highlight">
  <pre><code class="language-sh"># Build binaries for testing
go run hack/e2e.go --build

# Create a fresh cluster.  Deletes a cluster first, if it exists
go run hack/e2e.go --up

# Create a fresh cluster at a specific release version.
go run hack/e2e.go --up --version=0.7.0

# Test if a cluster is up.
go run hack/e2e.go --isup

# Push code to an existing cluster
go run hack/e2e.go --push

# Push to an existing cluster, or bring up a cluster if it's down.
go run hack/e2e.go --pushup

# Run all tests
go run hack/e2e.go --test

# Run tests matching the regex "Pods.*env"
go run hack/e2e.go -v -test --test_args="--ginkgo.focus=Pods.*env"

# Alternately, if you have the e2e cluster up and no desire to see the event stream, you can run ginkgo-e2e.sh directly:
hack/ginkgo-e2e.sh --ginkgo.focus=Pods.*env
</code></pre>
</div>

<h3 id="combining-flags">Combining flags</h3>

<div class="highlight">
  <pre><code class="language-sh"># Flags can be combined, and their actions will take place in this order:
# -build, -push|-up|-pushup, -test|-tests=..., -down
# e.g.:
go run hack/e2e.go -build -pushup -test -down

# -v (verbose) can be added if you want streaming output instead of only
# seeing the output of failed commands.

# -ctl can be used to quickly call kubectl against your e2e cluster. Useful for
# cleaning up after a failed test or viewing logs. Use -v to avoid suppressing
# kubectl output.
go run hack/e2e.go -v -ctl='get events'
go run hack/e2e.go -v -ctl='delete pod foobar'
</code></pre>
</div>

<h2 id="conformance-testing">Conformance testing</h2>

<p>End-to-end testing, as described above, is for <a href="writing-a-getting-started-guide.html">development
distributions</a>.  A conformance test is used on
a <a href="writing-a-getting-started-guide.html">versioned distro</a>.</p>

<p>The conformance test runs a subset of the e2e-tests against a manually-created cluster.  It does not
require support for up/push/down and other operations.  To run a conformance test, you need to know the
IP of the master for your cluster and the authorization arguments to use.  The conformance test is
intended to run against a cluster at a specific binary release of Kubernetes.
See <a href="http://releases.k8s.io/release-1.1/hack/conformance-test.sh">conformance-test.sh</a>.</p>

<h2 id="testing-out-flaky-tests">Testing out flaky tests</h2>

<p><a href="flaky-tests.html">Instructions here</a></p>

<h2 id="regenerating-the-cli-documentation">Regenerating the CLI documentation</h2>

<div class="highlight">
  <pre><code class="language-sh">hack/update-generated-docs.sh
</code></pre>
</div>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/devel/development.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



