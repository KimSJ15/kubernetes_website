<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Rolling update example</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Rolling update example</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->
<!--
Copyright 2014 Google Inc. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->

<h1 id="rolling-update-example">Rolling update example</h1>

<p>This example demonstrates the usage of Kubernetes to perform a <a href="../kubectl/kubectl_rolling-update.html">rolling update</a> on a running group of <a href="../../../docs/user-guide/pods.html">pods</a>. See <a href="../managing-deployments.html#updating-your-application-without-a-service-outage">here</a> to understand why you need a rolling update. Also check <a href="../../design/simple-rolling-update.html">rolling update design document</a> for more information.</p>

<h3 id="step-zero-prerequisites">Step Zero: Prerequisites</h3>

<p>This example assumes that you have forked the repository and <a href="../../../docs/getting-started-guides/">turned up a Kubernetes cluster</a>:</p>

<div class="highlight">
  <pre><code class="language-console">$ cd kubernetes
$ ./cluster/kube-up.sh
</code></pre>
</div>

<h3 id="step-one-turn-up-the-ux-for-the-demo">Step One: Turn up the UX for the demo</h3>

<p>You can use bash job control to run this in the background (note that you must use the default port – 8001 – for the following demonstration to work properly).
This can sometimes spew to the output so you could also run it in a different terminal. You have to run <code>kubectl proxy</code> in the root of the
Kubernetes repository. Otherwise you will get “404 page not found” errors as the paths will not match. You can find more information about <code>kubectl proxy</code>
<a href="../../../docs/user-guide/kubectl/kubectl_proxy.html">here</a>.</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl proxy --www=docs/user-guide/update-demo/local/ &amp;
I0218 15:18:31.623279   67480 proxy.go:36] Starting to serve on localhost:8001
</code></pre>
</div>

<p>Now visit the the <a href="http://localhost:8001/static">demo website</a>.  You won’t see anything much quite yet.</p>

<h3 id="step-two-run-the-replication-controller">Step Two: Run the replication controller</h3>

<p>Now we will turn up two replicas of an <a href="../images.html">image</a>.  They all serve on internal port 80.</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl create -f docs/user-guide/update-demo/nautilus-rc.yaml
</code></pre>
</div>

<p>After pulling the image from the Docker Hub to your worker nodes (which may take a minute or so) you’ll see a couple of squares in the UI detailing the pods that are running along with the image that they are serving up.  A cute little nautilus.</p>

<h3 id="step-three-try-scaling-the-replication-controller">Step Three: Try scaling the replication controller</h3>

<p>Now we will increase the number of replicas from two to four:</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl scale rc update-demo-nautilus --replicas=4
</code></pre>
</div>

<p>If you go back to the <a href="http://localhost:8001/static/index.html">demo website</a> you should eventually see four boxes, one for each pod.</p>

<h3 id="step-four-update-the-docker-image">Step Four: Update the docker image</h3>

<p>We will now update the docker image to serve a different image by doing a rolling update to a new Docker image.</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl rolling-update update-demo-nautilus --update-period=10s -f docs/user-guide/update-demo/kitten-rc.yaml
</code></pre>
</div>

<p>The rolling-update command in kubectl will do 2 things:</p>

<ol>
  <li>Create a new <a href="../../../docs/user-guide/replication-controller.html">replication controller</a> with a pod template that uses the new image (<code>gcr.io/google_containers/update-demo:kitten</code>)</li>
  <li>Scale the old and new replication controllers until the new controller replaces the old. This will kill the current pods one at a time, spinning up new ones to replace them.</li>
</ol>

<p>Watch the <a href="http://localhost:8001/static/index.html">demo website</a>, it will update one pod every 10 seconds until all of the pods have the new image.
Note that the new replication controller definition does not include the replica count, so the current replica count of the old replication controller is preserved.
But if the replica count had been specified, the final replica count of the new replication controller will be equal this number.</p>

<h3 id="step-five-bring-down-the-pods">Step Five: Bring down the pods</h3>

<div class="highlight">
  <pre><code class="language-console">$ kubectl delete rc update-demo-kitten
</code></pre>
</div>

<p>This first stops the replication controller by turning the target number of replicas to 0 and then deletes the controller.</p>

<h3 id="step-six-cleanup">Step Six: Cleanup</h3>

<p>To turn down a Kubernetes cluster:</p>

<div class="highlight">
  <pre><code class="language-console">$ ./cluster/kube-down.sh
</code></pre>
</div>

<p>Kill the proxy running in the background:
After you are done running this demo make sure to kill it:</p>

<div class="highlight">
  <pre><code class="language-console">$ jobs
[1]+  Running                 ./kubectl proxy --www=local/ &amp;
$ kill %1
[1]+  Terminated: 15          ./kubectl proxy --www=local/
</code></pre>
</div>

<h3 id="updating-the-docker-images">Updating the Docker images</h3>

<p>If you want to build your own docker images, you can set <code>$DOCKER_HUB_USER</code> to your Docker user id and run the included shell script. It can take a few minutes to download/upload stuff.</p>

<div class="highlight">
  <pre><code class="language-console">$ export DOCKER_HUB_USER=my-docker-id
$ ./docs/user-guide/update-demo/build-images.sh
</code></pre>
</div>

<p>To use your custom docker image in the above examples, you will need to change the image name in <code>docs/user-guide/update-demo/nautilus-rc.yaml</code> and <code>docs/user-guide/update-demo/kitten-rc.yaml</code>.</p>

<h3 id="image-copyright">Image Copyright</h3>

<p>Note that the images included here are public domain.</p>

<ul>
  <li><a href="http://commons.wikimedia.org/wiki/File:Kitten-stare.jpg">kitten</a></li>
  <li><a href="http://commons.wikimedia.org/wiki/File:Nautilus_pompilius.jpg">nautilus</a></li>
</ul>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/user-guide/update-demo/README.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



