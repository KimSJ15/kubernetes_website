<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Jobs</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/guides">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Jobs</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h1 id="jobs">Jobs</h1>

<p><strong>Table of Contents</strong>
<!-- BEGIN MUNGE: GENERATED_TOC --></p>

<ul>
  <li><a href="#jobs">Jobs</a>
    <ul>
      <li><a href="#what-is-a-job">What is a <em>job</em>?</a></li>
      <li><a href="#running-an-example-job">Running an example Job</a></li>
      <li><a href="#writing-a-job-spec">Writing a Job Spec</a>
        <ul>
          <li><a href="#pod-template">Pod Template</a></li>
          <li><a href="#pod-selector">Pod Selector</a></li>
          <li><a href="#multiple-completions">Multiple Completions</a></li>
          <li><a href="#parallelism">Parallelism</a></li>
        </ul>
      </li>
      <li><a href="#handling-pod-and-container-failures">Handling Pod and Container Failures</a></li>
      <li><a href="#alternatives-to-job">Alternatives to Job</a>
        <ul>
          <li><a href="#bare-pods">Bare Pods</a></li>
          <li><a href="#replication-controller">Replication Controller</a></li>
        </ul>
      </li>
      <li><a href="#caveats">Caveats</a></li>
      <li><a href="#future-work">Future work</a></li>
    </ul>
  </li>
</ul>

<!-- END MUNGE: GENERATED_TOC -->

<h2 id="what-is-a-job">What is a <em>job</em>?</h2>

<p>A <em>job</em> creates one or more pods and ensures that a specified number of them successfully terminate.
As pods successfully complete, the <em>job</em> tracks the successful completions.  When a specified number
of successful completions is reached, the job itself is complete.  Deleting a Job will cleanup the
pods it created.</p>

<p>A simple case is to create 1 Job object in order to reliably run one Pod to completion.
A Job can also be used to run multiple pods in parallel.</p>

<h2 id="running-an-example-job">Running an example Job</h2>

<p>Here is an example Job config.  It computes π to 2000 places and prints it out.
It takes around 10s to complete.
<!-- BEGIN MUNGE: EXAMPLE job.yaml --></p>

<div class="highlight">
  <pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Job
metadata:
  name: pi
spec:
  selector:
    matchLabels:
      app: pi
  template:
    metadata:
      name: pi
      labels:
        app: pi
    spec:
      containers:
      - name: pi
        image: perl
        command: ["perl",  "-Mbignum=bpi", "-wle", "print bpi(2000)"]
      restartPolicy: Never
</code></pre>
</div>

<p><a href="job.yaml">Download example</a>
<!-- END MUNGE: EXAMPLE job.yaml --></p>

<p>Run the example job by downloading the example file and then running this command:</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl create -f ./job.yaml
jobs/pi
</code></pre>
</div>

<p>Check on the status of the job using this command:</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl describe jobs/pi
Name:		pi
Namespace:	default
Image(s):	perl
Selector:	app=pi
Parallelism:	2
Completions:	1
Labels:		&lt;none&gt;
Pods Statuses:	1 Running / 0 Succeeded / 0 Failed
Events:
  FirstSeen	LastSeen	Count	From	SubobjectPath	Reason			Message
  ─────────	────────	─────	────	─────────────	──────			───────
  1m		1m		1	{job }			SuccessfulCreate	Created pod: pi-z548a
</code></pre>
</div>

<p>To view completed pods of a job, use <code>kubectl get pods --show-all</code>.  The <code>--show-all</code> will show completed pods too.</p>

<p>To list all the pods that belong to job in a machine readable form, you can use a command like this:</p>

<div class="highlight">
  <pre><code class="language-console">$ pods=$(kubectl get pods --selector=app=pi --output=jsonpath={.items..metadata.name})
echo $pods
pi-aiw0a
</code></pre>
</div>

<p>Here, the selector is the same as the selector for the job.  The <code>--output=jsonpath</code> option specifies an expression
that just gets the name from each pod in the returned list.</p>

<p>View the standard output of one of the pods:</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl logs pi-aiw0a
3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632788659361533818279682303019520353018529689957736225994138912497217752834791315155748572424541506959508295331168617278558890750983817546374649393192550604009277016711390098488240128583616035637076601047101819429555961989467678374494482553797747268471040475346462080466842590694912933136770289891521047521620569660240580381501935112533824300355876402474964732639141992726042699227967823547816360093417216412199245863150302861829745557067498385054945885869269956909272107975093029553211653449872027559602364806654991198818347977535663698074265425278625518184175746728909777727938000816470600161452491921732172147723501414419735685481613611573525521334757418494684385233239073941433345477624168625189835694855620992192221842725502542568876717904946016534668049886272327917860857843838279679766814541009538837863609506800642251252051173929848960841284886269456042419652850222106611863067442786220391949450471237137869609563643719172874677646575739624138908658326459958133904780275901
</code></pre>
</div>

<h2 id="writing-a-job-spec">Writing a Job Spec</h2>

<p>As with all other Kubernetes config, a Job needs <code>apiVersion</code>, <code>kind</code>, and <code>metadata</code> fields.  For
general information about working with config files, see <a href="simple-yaml.html">here</a>,
<a href="configuring-containers.html">here</a>, and <a href="working-with-resources.html">here</a>.</p>

<p>A Job also needs a <a href="../devel/api-conventions.html#spec-and-status"><code>.spec</code> section</a>.</p>

<h3 id="pod-template">Pod Template</h3>

<p>The <code>.spec.template</code> is the only required field of the <code>.spec</code>.</p>

<p>The <code>.spec.template</code> is a <a href="replication-controller.html#pod-template">pod template</a>.  It has exactly
the same schema as a <a href="pods.html">pod</a>, except it is nested and does not have an <code>apiVersion</code> or
<code>kind</code>.</p>

<p>In addition to required fields for a Pod, a pod template in a job must specify appropriate
lables (see <a href="#pod-selector">pod selector</a> and an appropriate restart policy.</p>

<p>Only a <a href="pod-states.html"><code>RestartPolicy</code></a> equal to <code>Never</code> or <code>OnFailure</code> are allowed.</p>

<h3 id="pod-selector">Pod Selector</h3>

<p>The <code>.spec.selector</code> field is a label query over a set of pods.</p>

<p>The <code>spec.selector</code> is an object consisting of two fields:
* <code>matchLabels</code> - works the same as the <code>.spec.selector</code> of a <a href="replication-controller.html">ReplicationController</a>
* <code>matchExpressions</code> - allows to build more sophisticated selectors by specyfing key,
  list of values and an operator that relates the key and values.</p>

<p>When the two are specified the result is ANDed.</p>

<p>If <code>.spec.selector</code> is unspecified, <code>.spec.selector.matchLabels</code> will be defaulted to
<code>.spec.template.metadata.labels</code>.</p>

<p>Also you should not normally create any pods whose labels match this selector, either directly,
via another Job, or via another controller such as ReplicationController.  Otherwise, the Job will
think that those pods were created by it.  Kubernetes will not stop you from doing this.</p>

<h3 id="multiple-completions">Multiple Completions</h3>

<p>By default, a Job is complete when one Pod runs to successful completion.  You can also specify that
this needs to happen multiple times by specifying <code>.spec.completions</code> with a value greater than 1.
When multiple completions are requested, each Pod created by the Job controller has an identical
<a href="../devel/api-conventions.html#spec-and-status"><code>spec</code></a>.  In particular, all pods will have
the same command line and the same image, the same volumes, and mostly the same environment
variables.  It is up to the user to arrange for the pods to do work on different things.  For
example, the pods might all access a shared work queue service to acquire work units.</p>

<p>To create multiple pods which are similar, but have slightly different arguments, environment
variables or images, use multiple Jobs.</p>

<h3 id="parallelism">Parallelism</h3>

<p>You can suggest how many pods should run concurrently by setting <code>.spec.parallelism</code> to the number
of pods you would like to have running concurrently.  This number is a suggestion. The number
running concurrently may be lower or higher for a variety of reasons.  For example, it may be lower
if the number of remaining completions is less, or as the controller is ramping up, or if it is
throttling the job due to excessive failures.  It may be higher for example if a pod is gracefully
shutdown, and the replacement starts early.</p>

<p>If you do not specify <code>.spec.parallelism</code>, then it defaults to <code>.spec.completions</code>.</p>

<h2 id="handling-pod-and-container-failures">Handling Pod and Container Failures</h2>

<p>A Container in a Pod may fail for a number of reasons, such as because the process in it exited with
a non-zero exit code, or the Container was killed for exceeding a memory limit, etc.  If this
happens, and the <code>.spec.template.containers[].restartPolicy = "OnFailure"</code>, then the Pod stays
on the node, but the Container is re-run.  Therefore, your program needs to handle the the case when it is
restarted locally, or else specify <code>.spec.template.containers[].restartPolicy = "Never"</code>.
See <a href="pod-states.html">pods-states</a> for more information on <code>restartPolicy</code>.</p>

<p>An entire Pod can also fail, for a number of reasons, such as when the pod is kicked off the node
(node is upgraded, rebooted, delelted, etc.), or if a container of the Pod fails and the
<code>.spec.template.containers[].restartPolicy = "Never"</code>.  When a Pod fails, then the Job controller
starts a new Pod.  Therefore, your program needs to handle the case when it is restarted in a new
pod.  In particular, it needs to handle temporary files, locks, incomplete output and the like
caused by previous runs.</p>

<p>Note that even if you specify <code>.spec.parallelism = 1</code> and <code>.spec.completions = 1</code> and
<code>.spec.template.containers[].restartPolicy = "Never"</code>, the same program may
sometimes be started twice.</p>

<p>If you do specify <code>.spec.parallelism</code> and <code>.spec.completions</code> both greater than 1, then there may be
multiple pods running at once.  Therefore, your pods must also be tolerant of concurrency.</p>

<h2 id="alternatives-to-job">Alternatives to Job</h2>

<h3 id="bare-pods">Bare Pods</h3>

<p>When the node that a pod is running on reboots or fails, the pod is terminated
and will not be restarted.  However, a Job will create new pods to replace terminated ones.
For this reason, we recommend that you use a job rather than a bare pod, even if your application
requires only a single pod.</p>

<h3 id="replication-controller">Replication Controller</h3>

<p>Jobs are complementary to <a href="replication-controller.html">Replication Controllers</a>.
A Replication Controller manages pods which are not expected to terminate (e.g. web servers), and a Job
manages pods that are expected to terminate (e.g. batch jobs).</p>

<p>As discussed in <a href="pod-states.html">life of a pod</a>, <code>Job</code> is <em>only</em> appropriate for pods with
<code>RestartPolicy</code> equal to <code>OnFailure</code> or <code>Never</code>.  (Note: If <code>RestartPolicy</code> is not set, the default
value is <code>Always</code>.)</p>

<h2 id="caveats">Caveats</h2>

<p>Job objects are in the <a href="../api.html#api-groups"><code>extensions</code> API Group</a>.</p>

<p>Job objects have <a href="../api.html#api-versioning">API version <code>v1beta1</code></a>.  Beta objects may
undergo changes to their schema and/or semantics in future software releases, but
similar functionality will be supported.</p>

<h2 id="future-work">Future work</h2>

<p>Support for creating Jobs at specified times/dates (i.e. cron) is expected in the next minor
release.</p>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/user-guide/jobs.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



