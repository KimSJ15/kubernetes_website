<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Images</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/guides">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Images</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h1 id="images">Images</h1>

<p>Each container in a pod has its own image.  Currently, the only type of image supported is a <a href="https://docs.docker.com/userguide/dockerimages/">Docker Image</a>.</p>

<p>You create your Docker image and push it to a registry before referring to it in a Kubernetes pod.</p>

<p>The <code>image</code> property of a container supports the same syntax as the <code>docker</code> command does, including private registries and tags.</p>

<p><strong>Table of Contents</strong>
<!-- BEGIN MUNGE: GENERATED_TOC --></p>

<ul>
  <li><a href="#images">Images</a>
    <ul>
      <li><a href="#updating-images">Updating Images</a></li>
      <li><a href="#using-a-private-registry">Using a Private Registry</a>
        <ul>
          <li><a href="#using-google-container-registry">Using Google Container Registry</a></li>
          <li><a href="#configuring-nodes-to-authenticate-to-a-private-repository">Configuring Nodes to Authenticate to a Private Repository</a></li>
          <li><a href="#pre-pulling-images">Pre-pulling Images</a></li>
          <li><a href="#specifying-imagepullsecrets-on-a-pod">Specifying ImagePullSecrets on a Pod</a></li>
          <li><a href="#use-cases">Use Cases</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<!-- END MUNGE: GENERATED_TOC -->

<h2 id="updating-images">Updating Images</h2>

<p>The default pull policy is <code>IfNotPresent</code> which causes the Kubelet to not
pull an image if it already exists. If you would like to always force a pull
you must set a pull image policy of <code>Always</code> or specify a <code>:latest</code> tag on
your image.</p>

<h2 id="using-a-private-registry">Using a Private Registry</h2>

<p>Private registries may require keys to read images from them.
Credentials can be provided in several ways:
  - Using Google Container Registry
    - Per-cluster
    - automatically configured on Google Compute Engine or Google Container Engine
    - all pods can read the project’s private registry
  - Configuring Nodes to Authenticate to a Private Registry
    - all pods can read any configured private registries
    - requires node configuration by cluster administrator
  - Pre-pulling Images
    - all pods can use any images cached on a node
    - requires root access to all nodes to setup
  - Specifying ImagePullSecrets on a Pod
    - only pods which provide own keys can access the private registry
Each option is described in more detail below.</p>

<h3 id="using-google-container-registry">Using Google Container Registry</h3>

<p>Kubernetes has native support for the <a href="https://cloud.google.com/tools/container-registry/">Google Container
Registry (GCR)</a>, when running on Google Compute
Engine (GCE).  If you are running your cluster on GCE or Google Container Engine (GKE), simply
use the full image name (e.g. gcr.io/my_project/image:tag).</p>

<p>All pods in a cluster will have read access to images in this registry.</p>

<p>The kubelet will authenticate to GCR using the instance’s
Google service account.  The service account on the instance
will have a <code>https://www.googleapis.com/auth/devstorage.read_only</code>,
so it can pull from the project’s GCR, but not push.</p>

<h3 id="configuring-nodes-to-authenticate-to-a-private-repository">Configuring Nodes to Authenticate to a Private Repository</h3>

<p><strong>Note:</strong> if you are running on Google Container Engine (GKE), there will already be a <code>.dockercfg</code> on each node
with credentials for Google Container Registry.  You cannot use this approach.</p>

<p><strong>Note:</strong> this approach is suitable if you can control node configuration.  It
will not work reliably on GCE, and any other cloud provider that does automatic
node replacement.</p>

<p>Docker stores keys for private registries in the <code>$HOME/.dockercfg</code> file.  If you put this
in the <code>$HOME</code> of <code>root</code> on a kubelet, then docker will use it.</p>

<p>Here are the recommended steps to configuring your nodes to use a private registry.  In this
example, run these on your desktop/laptop:
   1. run <code>docker login [server]</code> for each set of credentials you want to use.
   1. view <code>$HOME/.dockercfg</code> in an editor to ensure it contains just the credentials you want to use.
   1. get a list of your nodes
      - for example: <code>nodes=$(kubectl get nodes -o template --template=' ')</code>
   1. copy your local <code>.dockercfg</code> to the home directory of root on each node.
      - for example: <code>for n in $nodes; do scp ~/.dockercfg root@$n:/root/.dockercfg; done</code></p>

<p>Verify by creating a pod that uses a private image, e.g.:</p>

<div class="highlight">
  <pre><code class="language-yaml">$ cat &lt;&lt;EOF &gt; /tmp/private-image-test-1.yaml
apiVersion: v1
kind: Pod
metadata:
  name: private-image-test-1
spec:
  containers:
    - name: uses-private-image
      image: $PRIVATE_IMAGE_NAME
      imagePullPolicy: Always
      command: [ "echo", "SUCCESS" ]
EOF
$ kubectl create -f /tmp/private-image-test-1.yaml
pods/private-image-test-1
$
</code></pre>
</div>

<p>If everything is working, then, after a few moments, you should see:</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl logs private-image-test-1
SUCCESS
</code></pre>
</div>

<p>If it failed, then you will see:</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl describe pods/private-image-test-1 | grep "Failed"
  Fri, 26 Jun 2015 15:36:13 -0700	Fri, 26 Jun 2015 15:39:13 -0700	19	{kubelet node-i2hq}	spec.containers{uses-private-image}	failed		Failed to pull image "user/privaterepo:v1": Error: image user/privaterepo:v1 not found
</code></pre>
</div>

<p>You must ensure all nodes in the cluster have the same <code>.dockercfg</code>.  Otherwise, pods will run on
some nodes and fail to run on others.  For example, if you use node autoscaling, then each instance
template needs to include the <code>.dockercfg</code> or mount a drive that contains it.</p>

<p>All pods will have read access to images in any private registry once private
registry keys are added to the <code>.dockercfg</code>.</p>

<p><strong>This was tested with a private docker repository as of 26 June with Kubernetes version v0.19.3.
It should also work for a private registry such as quay.io, but that has not been tested.</strong></p>

<h3 id="pre-pulling-images">Pre-pulling Images</h3>

<p><strong>Note:</strong> if you are running on Google Container Engine (GKE), there will already be a <code>.dockercfg</code> on each node
with credentials for Google Container Registry.  You cannot use this approach.</p>

<p><strong>Note:</strong> this approach is suitable if you can control node configuration.  It
will not work reliably on GCE, and any other cloud provider that does automatic
node replacement.</p>

<p>Be default, the kubelet will try to pull each image from the specified registry.
However, if the <code>imagePullPolicy</code> property of the container is set to <code>IfNotPresent</code> or <code>Never</code>,
then a local image is used (preferentially or exclusively, respectively).</p>

<p>If you want to rely on pre-pulled images as a substitute for registry authentication,
you must ensure all nodes in the cluster have the same pre-pulled images.</p>

<p>This can be used to preload certain images for speed or as an alternative to authenticating to a private registry.</p>

<p>All pods will have read access to any pre-pulled images.</p>

<h3 id="specifying-imagepullsecrets-on-a-pod">Specifying ImagePullSecrets on a Pod</h3>

<p><strong>Note:</strong> This approach is currently the recommended approach for GKE, GCE, and any cloud-providers
where node creation is automated.</p>

<p>Kubernetes supports specifying registry keys on a pod.</p>

<p>First, create a <code>.dockercfg</code>, such as running <code>docker login &lt;registry.domain&gt;</code>.
Then put the resulting <code>.dockercfg</code> file into a <a href="secrets.html">secret resource</a>.  For example:</p>

<div class="highlight">
  <pre><code class="language-console">$ docker login
Username: janedoe
Password: ●●●●●●●●●●●
Email: jdoe@example.com
WARNING: login credentials saved in /Users/jdoe/.dockercfg.
Login Succeeded

$ echo $(cat ~/.dockercfg)
{ "https://index.docker.io/v1/": { "auth": "ZmFrZXBhc3N3b3JkMTIK", "email": "jdoe@example.com" } }

$ cat ~/.dockercfg | base64
eyAiaHR0cHM6Ly9pbmRleC5kb2NrZXIuaW8vdjEvIjogeyAiYXV0aCI6ICJabUZyWlhCaGMzTjNiM0prTVRJSyIsICJlbWFpbCI6ICJqZG9lQGV4YW1wbGUuY29tIiB9IH0K

$ cat &gt; /tmp/image-pull-secret.yaml &lt;&lt;EOF
apiVersion: v1
kind: Secret
metadata:
  name: myregistrykey
data:
  .dockercfg: eyAiaHR0cHM6Ly9pbmRleC5kb2NrZXIuaW8vdjEvIjogeyAiYXV0aCI6ICJabUZyWlhCaGMzTjNiM0prTVRJSyIsICJlbWFpbCI6ICJqZG9lQGV4YW1wbGUuY29tIiB9IH0K
type: kubernetes.io/dockercfg
EOF

$ kubectl create -f /tmp/image-pull-secret.yaml
secrets/myregistrykey
$
</code></pre>
</div>

<p>If you get the error message <code>error: no objects passed to create</code>, it may mean the base64 encoded string is invalid.
If you get an error message like <code>Secret "myregistrykey" is invalid: data[.dockercfg]: invalid value ...</code> it means
the data was successfully un-base64 encoded, but could not be parsed as a dockercfg file.</p>

<p>This process only needs to be done one time (per namespace).</p>

<p>Now, you can create pods which reference that secret by adding an <code>imagePullSecrets</code>
section to a pod definition.</p>

<div class="highlight">
  <pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: foo
spec:
  containers:
    - name: foo
      image: janedoe/awesomeapp:v1
  imagePullSecrets:
    - name: myregistrykey
</code></pre>
</div>

<p>This needs to be done for each pod that is using a private registry.
However, setting of this field can be automated by setting the imagePullSecrets
in a <a href="service-accounts.html">serviceAccount</a> resource.</p>

<p>Currently, all pods will potentially have read access to any images which were
pulled using imagePullSecrets.  That is, imagePullSecrets does <em>NOT</em> protect your
images from being seen by other users in the cluster.  Our intent
is to fix that.</p>

<p>You can use this in conjunction with a per-node <code>.dockerfile</code>.  The credentials
will be merged.  This approach will work on Google Container Engine (GKE).</p>

<h3 id="use-cases">Use Cases</h3>

<p>There are a number of solutions for configuring private registries.  Here are some
common use cases and suggested solutions.</p>

<ol>
  <li>Cluster running only non-proprietary (e.g open-source) images.  No need to hide images.
    <ul>
      <li>Use public images on the Docker hub.</li>
      <li>no configuration required</li>
      <li>on GCE/GKE, a local mirror is automatically used for improved speed and availability</li>
    </ul>
  </li>
  <li>Cluster running some proprietary images which should be hidden to those outside the company, but
   visible to all cluster users.
    <ul>
      <li>Use a hosted private <a href="https://docs.docker.com/registry/">Docker registry</a></li>
      <li>may be hosted on the <a href="https://hub.docker.com/account/signup/">Docker Hub</a>, or elsewhere.</li>
      <li>manually configure .dockercfg on each node as described above
        <ul>
          <li>Or, run an internal private registry behind your firewall with open read access.</li>
        </ul>
      </li>
      <li>no Kubernetes configuration required
        <ul>
          <li>Or, when on GCE/GKE, use the project’s Google Container Registry.</li>
        </ul>
      </li>
      <li>will work better with cluster autoscaling than manual node configuration
        <ul>
          <li>Or, on a cluster where changing the node configuration is inconvenient, use <code>imagePullSecrets</code>.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Cluster with a proprietary images, a few of which require stricter access control
    <ul>
      <li>Move sensitive data into a “Secret” resource, instead of packaging it in an image.</li>
      <li>DO NOT use imagePullSecrets for this use case yet.</li>
    </ul>
  </li>
  <li>A multi-tenant cluster where each tenant needs own private registry
    <ul>
      <li>NOT supported yet.</li>
    </ul>
  </li>
</ol>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/user-guide/images.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



