<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Static pods (deprecated)</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Static pods (deprecated)</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h1 id="static-pods-deprecated">Static pods (deprecated)</h1>

<p><strong>Static pods are to be deprecated and can be removed in any future Kubernetes release!</strong></p>

<p><em>Static pod</em> are managed directly by kubelet daemon on a specific node, without API server observing it. It does not have associated any replication controller, kubelet daemon itself watches it and restarts it when it crashes. There is no health check though. Static pods are always bound to one kubelet daemon and always run on the same node with it.</p>

<p>Kubelet automatically creates so-called <em>mirror pod</em> on Kubernetes API server for each static pod, so the pods are visible there, but they cannot be controlled from the API server.</p>

<h2 id="static-pod-creation">Static pod creation</h2>

<p>Static pod can be created in two ways: either by using configuration file(s) or by HTTP.</p>

<h3 id="configuration-files">Configuration files</h3>

<p>The configuration files are just standard pod definition in json or yaml format in specific directory. Use <code>kubelet --config=&lt;the directory&gt;</code> to start kubelet daemon, which periodically scans the directory and creates/deletes static pods as yaml/json files appear/disappear there.</p>

<p>For example, this is how to start a simple web server as a static pod:</p>

<ol>
  <li>Choose a node where we want to run the static pod. In this example, it’s <code>my-minion1</code>.</li>
</ol>

<div class="highlight">
  <pre><code class="language-console">[joe@host ~] $ ssh my-minion1
</code></pre>
</div>

<ol>
  <li>Choose a directory, say <code>/etc/kubelet.d</code> and place a web server pod definition there, e.g. <code>/etc/kubernetes.d/static-web.yaml</code>:</li>
</ol>

<div class="highlight">
  <pre><code class="language-console">[root@my-minion1 ~] $ mkdir /etc/kubernetes.d/
    [root@my-minion1 ~] $ cat &lt;&lt;EOF &gt;/etc/kubernetes.d/static-web.yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: static-web
      labels:
        role: myrole
    spec:
      containers:
        - name: web
          image: nginx
          ports:
            - name: web
              containerPort: 80
              protocol: tcp
    EOF
</code></pre>
</div>

<ol>
  <li>
    <p>Configure your kubelet daemon on the node to use this directory by running it with <code>--config=/etc/kubelet.d/</code> argument.  On Fedora Fedora 21 with Kubernetes 0.17 edit <code>/etc/kubernetes/kubelet</code> to include this line:</p>

    <p>```</p>

    <p>KUBELET_ARGS=”–cluster-dns=10.254.0.10 –cluster-domain=kube.local –config=/etc/kubelet.d/”</p>

    <p>```</p>

    <p>Instructions for other distributions or Kubernetes installations may vary.</p>
  </li>
  <li>
    <p>Restart kubelet. On Fedora 21, this is:</p>
  </li>
</ol>

<div class="highlight">
  <pre><code class="language-console">[root@my-minion1 ~] $ systemctl restart kubelet
</code></pre>
</div>

<h2 id="pods-created-via-http">Pods created via HTTP</h2>

<p>Kubelet periodically downloads a file specified by <code>--manifest-url=&lt;URL&gt;</code> argument and interprets it as a json/yaml file with a pod definition. It works the same as <code>--config=&lt;directory&gt;</code>, i.e. it’s reloaded every now and then and changes are applied to running static pods (see below).</p>

<h2 id="behavior-of-static-pods">Behavior of static pods</h2>

<p>When kubelet starts, it automatically starts all pods defined in directory specified in <code>--config=</code> or <code>--manifest-url=</code> arguments, i.e. our static-web.  (It may take some time to pull nginx image, be patient…):</p>

<div class="highlight">
  <pre><code class="language-console">[joe@my-minion1 ~] $ docker ps
CONTAINER ID IMAGE         COMMAND  CREATED        STATUS              NAMES
f6d05272b57e nginx:latest  "nginx"  8 minutes ago  Up 8 minutes        k8s_web.6f802af4_static-web-fk-minion1_default_67e24ed9466ba55986d120c867395f3c_378e5f3c
</code></pre>
</div>

<p>If we look at our Kubernetes API server (running on host <code>my-master</code>), we see that a new mirror-pod was created there too:</p>

<div class="highlight">
  <pre><code class="language-console">[joe@host ~] $ ssh my-master
[joe@my-master ~] $ kubectl get pods
POD                     IP           CONTAINER(S)   IMAGE(S)    HOST                        LABELS       STATUS    CREATED         MESSAGE
static-web-my-minion1   172.17.0.3                              my-minion1/192.168.100.71   role=myrole  Running   11 minutes
                                     web            nginx                                                Running   11 minutes
</code></pre>
</div>

<p>Labels from the static pod are propagated into the mirror-pod and can be used as usual for filtering.</p>

<p>Notice we cannot delete the pod with the API server (e.g. via <a href="../user-guide/kubectl/kubectl.html"><code>kubectl</code></a> command), kubelet simply won’t remove it.</p>

<div class="highlight">
  <pre><code class="language-console">[joe@my-master ~] $ kubectl delete pod static-web-my-minion1
pods/static-web-my-minion1
[joe@my-master ~] $ kubectl get pods
POD                     IP           CONTAINER(S)   IMAGE(S)    HOST                        ...
static-web-my-minion1   172.17.0.3                              my-minion1/192.168.100.71   ...
</code></pre>
</div>

<p>Back to our <code>my-minion1</code> host, we can try to stop the container manually and see, that kubelet automatically restarts it in a while:</p>

<div class="highlight">
  <pre><code class="language-console">[joe@host ~] $ ssh my-minion1
[joe@my-minion1 ~] $ docker stop f6d05272b57e
[joe@my-minion1 ~] $ sleep 20
[joe@my-minion1 ~] $ docker ps
CONTAINER ID        IMAGE         COMMAND                CREATED       ...
5b920cbaf8b1        nginx:latest  "nginx -g 'daemon of   2 seconds ago ...
</code></pre>
</div>

<h2 id="dynamic-addition-and-removal-of-static-pods">Dynamic addition and removal of static pods</h2>

<p>Running kubelet periodically scans the configured directory (<code>/etc/kubelet.d</code> in our example) for changes and adds/removes pods as files appear/disappear in this directory.</p>

<div class="highlight">
  <pre><code class="language-console">[joe@my-minion1 ~] $ mv /etc/kubernetes.d/static-web.yaml /tmp
[joe@my-minion1 ~] $ sleep 20
[joe@my-minion1 ~] $ docker ps
// no nginx container is running
[joe@my-minion1 ~] $ mv /tmp/static-web.yaml  /etc/kubernetes.d/
[joe@my-minion1 ~] $ sleep 20
[joe@my-minion1 ~] $ docker ps
CONTAINER ID        IMAGE         COMMAND                CREATED           ...
e7a62e3427f1        nginx:latest  "nginx -g 'daemon of   27 seconds ago
</code></pre>
</div>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/static-pods.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



