<!Doctype html>
<html id="docs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
	<script src="/js/script.js"></script>
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/non-mini.js"></script>
    <title>Kubernetes - Resource Quotas</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs" class="button" id="viewDocs">View Documentation</a>
		<a href="/get-started" class="button" id="tryKubernetes">Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="">Get Started</a></h3>
				<p>Built for a multi-cloud world, public, private or hybrid. Seamlessly roll out new features.</p>
			</div>
			<div class="nav-box">
				<h3><a href="">Documentation</a></h3>
				<p>Pellentesque in ipsum id orci porta dapibus. Nulla porttitor accumsan tincidunt. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Community</a></h3>
				<p>Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui. </p>
			</div>
			<div class="nav-box">
				<h3><a href="">Blog</a></h3>
				<p>Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Quisque velit nisi, pretium ut lacinia in. </p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="" class="button">View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="Twitter"><span>twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>

<!--  HERO  -->
<section id="hero" class="light-text">
	<h1></h1>
	<h5></h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/v1.1/guides">GUIDES</a></li>
			<li><a href="/v1.1/reference">REFERENCE</a></li>
			<li><a href="/v1.1/samples">SAMPLES</a></li>
			<li><a href="/v1.1/support">SUPPORT</a></li>
		</ul>
		<div class="dropdown">
			<div class="readout"></div>
			<a href="/v1.1">Version 1.1</a>
			<a href="/v1.0">Version 1.0</a>
		</div>
		<input type="text" id="search" placeholder="Search the docs">
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
            
            

        </div> <!-- /pi-accordion -->
	</div> <!-- /docsToc -->
	<div id="docsContent">
    	<h1>Resource Quotas</h1>
		<!-- BEGIN MUNGE: UNVERSIONED_WARNING -->

<!-- END MUNGE: UNVERSIONED_WARNING -->

<h1 id="resource-quotas">Resource Quotas</h1>

<p>When several users or teams share a cluster with a fixed number of nodes,
there is a concern that one team could use more than its fair share of resources.</p>

<p>Resource quotas are a tool for administrators to address this concern. Resource quotas
work like this:
- Different teams work in different namespaces.  Currently this is voluntary, but
  support for making this mandatory via ACLs is planned.
- The administrator creates a Resource Quota for each namespace.
- Users put compute resource requests on their pods. The sum of all resource requests across
  all pods in the same namespace must not exceed any hard resource limit in any Resource Quota
  document for the namespace. Note that we used to verify Resource Quota by taking the sum of
  resource limits of the pods, but this was altered to use resource requests. Backwards compatibility
  for those pods previously created is preserved because pods that only specify a resource limit have
  their resource requests defaulted to match their defined limits. The user is only charged for the
  resources they request in the Resource Quota versus their limits because the request is the minimum
  amount of resource guaranteed by the cluster during scheduling. For more information on over commit,
  see <a href="../user-guide/compute-resources.html">compute-resources</a>.
- If creating a pod would cause the namespace to exceed any of the limits specified in the
  the Resource Quota for that namespace, then the request will fail with HTTP status
  code <code>403 FORBIDDEN</code>.
- If quota is enabled in a namespace and the user does not specify <em>requests</em> on the pod for each
  of the resources for which quota is enabled, then the POST of the pod will fail with HTTP
  status code <code>403 FORBIDDEN</code>.  Hint: Use the LimitRange admission controller to force default
  values of <em>limits</em> (then resource <em>requests</em> would be equal to <em>limits</em> by default, see
  <a href="admission-controllers.html">admission controller</a>) before the quota is checked to avoid this problem.</p>

<p>Examples of policies that could be created using namespaces and quotas are:
- In a cluster with a capacity of 32 GiB RAM, and 16 cores, let team A use 20 Gib and 10 cores,
  let B use 10GiB and 4 cores, and hold 2GiB and 2 cores in reserve for future allocation.
- Limit the “testing” namespace to using 1 core and 1GiB RAM.  Let the “production” namespace
  use any amount.</p>

<p>In the case where the total capacity of the cluster is less than the sum of the quotas of the namespaces,
there may be contention for resources.  This is handled on a first-come-first-served basis.</p>

<p>Neither contention nor changes to quota will affect already-running pods.</p>

<h2 id="enabling-resource-quota">Enabling Resource Quota</h2>

<p>Resource Quota support is enabled by default for many Kubernetes distributions.  It is
enabled when the apiserver <code>--admission-control=</code> flag has <code>ResourceQuota</code> as
one of its arguments.</p>

<p>Resource Quota is enforced in a particular namespace when there is a
<code>ResourceQuota</code> object in that namespace.  There should be at most one
<code>ResourceQuota</code> object in a namespace.</p>

<h2 id="compute-resource-quota">Compute Resource Quota</h2>

<p>The total sum of <a href="../user-guide/compute-resources.html">compute resources</a> requested by pods
in a namespace can be limited.  The following compute resource types are supported:</p>

<table>
  <thead>
    <tr>
      <th>ResourceName</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cpu</td>
      <td>Total cpu requests of containers</td>
    </tr>
    <tr>
      <td>memory</td>
      <td>Total memory requests of containers</td>
    </tr>
  </tbody>
</table>

<p>For example, <code>cpu</code> quota sums up the <code>resources.requests.cpu</code> fields of every
container of every pod in the namespace, and enforces a maximum on that sum.</p>

<h2 id="object-count-quota">Object Count Quota</h2>

<p>The number of objects of a given type can be restricted.  The following types
are supported:</p>

<table>
  <thead>
    <tr>
      <th>ResourceName</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pods</td>
      <td>Total number of pods</td>
    </tr>
    <tr>
      <td>services</td>
      <td>Total number of services</td>
    </tr>
    <tr>
      <td>replicationcontrollers</td>
      <td>Total number of replication controllers</td>
    </tr>
    <tr>
      <td>resourcequotas</td>
      <td>Total number of <a href="admission-controllers.html#resourcequota">resource quotas</a></td>
    </tr>
    <tr>
      <td>secrets</td>
      <td>Total number of secrets</td>
    </tr>
    <tr>
      <td>persistentvolumeclaims</td>
      <td>Total number of <a href="../user-guide/persistent-volumes.html#persistentvolumeclaims">persistent volume claims</a></td>
    </tr>
  </tbody>
</table>

<p>For example, <code>pods</code> quota counts and enforces a maximum on the number of <code>pods</code>
created in a single namespace.</p>

<p>You might want to set a pods quota on a namespace
to avoid the case where a user creates many small pods and exhausts the cluster’s
supply of Pod IPs.</p>

<h2 id="viewing-and-setting-quotas">Viewing and Setting Quotas</h2>

<p>Kubectl supports creating, updating, and viewing quotas:</p>

<div class="highlight">
  <pre><code class="language-console">$ kubectl namespace myspace
$ cat &lt;&lt;EOF &gt; quota.json
{
  "apiVersion": "v1",
  "kind": "ResourceQuota",
  "metadata": {
    "name": "quota",
  },
  "spec": {
    "hard": {
      "memory": "1Gi",
      "cpu": "20",
      "pods": "10",
      "services": "5",
      "replicationcontrollers":"20",
      "resourcequotas":"1",
    },
  }
}
EOF
$ kubectl create -f ./quota.json
$ kubectl get quota
NAME
quota
$ kubectl describe quota quota
Name:                   quota
Resource                Used    Hard
--------                ----    ----
cpu                     0m      20
memory                  0       1Gi
pods                    5       10
replicationcontrollers  5       20
resourcequotas          1       1
services                3       5
</code></pre>
</div>

<h2 id="quota-and-cluster-capacity">Quota and Cluster Capacity</h2>

<p>Resource Quota objects are independent of the Cluster Capacity. They are
expressed in absolute units.  So, if you add nodes to your cluster, this does <em>not</em>
automatically give each namespace the ability to consume more resources.</p>

<p>Sometimes more complex policies may be desired, such as:
  - proportionally divide total cluster resources among several teams.
  - allow each tenant to grow resource usage as needed, but have a generous
    limit to prevent accidental resource exhaustion.
  - detect demand from one namespace, add nodes, and increase quota.</p>

<p>Such policies could be implemented using ResourceQuota as a building-block, by
writing a ‘controller’ which watches the quota usage and adjusts the quota
hard limits of each namespace according to other signals.</p>

<p>Note that resource quota divides up aggregate cluster resources, but it creates no
restrictions around nodes: pods from several namespaces may run on the same node.</p>

<h2 id="example">Example</h2>

<p>See a <a href="resourcequota/">detailed example for how to use resource quota</a>..</p>

<h2 id="read-more">Read More</h2>

<p>See <a href="../design/admission_control_resource_quota.html">ResourceQuota design doc</a> for more information.</p>

<!-- BEGIN MUNGE: IS_VERSIONED -->
<!-- TAG IS_VERSIONED -->
<!-- END MUNGE: IS_VERSIONED -->

<!-- BEGIN MUNGE: GENERATED_ANALYTICS -->
<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/resource-quota.md?pixel" alt="Analytics" /></a>
<!-- END MUNGE: GENERATED_ANALYTICS --></p>


	</div>
</section>


<footer>
	<main class="light-text">
		<nav>
			<a href="/getting-started.html">Getting Started</a>
			<a href="/docs.html">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/foobang.html">Community</a>
		</nav>
		<div class="social">
			<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
			<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
			<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>stackoverflow</span></a>
			<a href="https://groups.google.com/forum/#!forum/google-containers" class="mailing-list"><span>Mailing List</span></a>
			<label for="wishField">I wish this page <input type="text" id="wishField" name="wishField" placeholder="made better textfield suggestions"></label>
		</div>
		<div class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>

</body>
</html>



